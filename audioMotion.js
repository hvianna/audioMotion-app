/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={2301:(e,t,a)=>{"use strict";var n=a(6708);const o=JSON.parse('{"i8":"24.2.0-beta.1"}'),s=location.origin+location.pathname,l="electron"in window,i=l&&/Windows/.test(navigator.userAgent),r=!!window.showDirectoryPicker,c="Click to open a new root folder",d="Click to open directory",u="No music found on server and no browser support for File System API",p=0;let f,h,m,b,g,v,y,k=[],w=[],x=!1,S=!1,L=!1,E=!1;function C(e,t){g.innerHTML="",v.innerHTML="",v.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.innerText=n,a.handle=e.handle,v.append(a)},n=e=>v.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==w.length&&(g.innerHTML=u),k.forEach((({dir:e},t)=>{g.innerHTML+=`<li data-depth="${k.length-t-1}">${e}</li> ${i?"\\":"/"==e?"":"/"} `})),x)v.innerHTML+=`<li data-type="request" class="full-panel">${d}</li>`;else if(w.forEach((e=>{v.innerHTML+=`<li data-type="mount" ${E&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),k.length>1&&(v.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),E&&t?t.handle.getFile().then((e=>{const t=URL.createObjectURL(e);n(t)})):n(t?T(t):"")}v.scrollTop=t||0}function $(e,t){let a,n,o=e&&"string"!=typeof e?e:null;if(o&&(e=o.name),e)if(".."==e){a=k.pop();const e=k[k.length-1];e&&e.handle&&(o=e.handle)}else k.push({dir:e,scrollTop:v.scrollTop,handle:o});return v.innerHTML="<li>Loading...</li>",n=T(),new Promise((async e=>{const s=n=>{!1!==n&&(S&&!E||(n=O(n)),C(n,t||a&&a.scrollTop),m&&m(k),e(!0)),e(!1)};if(f){o&&(f=o);let e=[];for await(const t of f.entries())e.push(t);s(e)}else fetch(n).then((e=>200==e.status&&(S?e.json():e.text()))).then((e=>s(e))).catch((()=>e(!1)))}))}function T(e,t){let a="";return k.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=a.replace(/#/g,"%23"),l?(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)):y==p&&(a=s+a),a}function A(e="li"){let t=[];return v.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:T(e.dataset.path),handle:e.handle,type:e.dataset.type})})),t}async function P(e){const t=[...k],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();".."==e?(t.pop(),n=t[t.length-1].handle):(n=await n.getDirectoryHandle(e),t.push({handle:n}))}return await n.getFileHandle(a.shift())}function I(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,n]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i);a.push({uri:t,file:n})}return a}function O(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp3|flac|m4a|aac|ogg|wav|m3u|m3u8|mkv|mpg|webm|mp4|avi|mov)$/i;let n=[],o=[],s=[];const l=(e,a)=>{const n=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(E)for(const[l,i]of e)i instanceof FileSystemDirectoryHandle?o.push({name:l,handle:i}):i instanceof FileSystemFileHandle&&(l.match(t)?s.push({name:l,handle:i}):l.match(a)&&n.push({name:l,handle:i}));else for(const{uri:l,file:i}of I(e))"/"==l.substring(l.length-1)?i.match(/(parent directory|\.\.)/i)||("/"==i.substring(i.length-1)?o.push(i.substring(0,i.length-1)):o.push(i)):i.match(t)?s.push(i):i.match(a)&&n.push(i);const i=(e,t)=>{const a="object"==typeof e;return(new Intl.Collator).compare(...a?[e.name,t.name]:[e,t])};return{cover:l(s,"cover")||l(s,"folder")||l(s,"front")||s[0],dirs:o.sort(i),files:n.sort(i)}}async function M(e){if(!e)return!1;const t=[...k],a=e[e.length-1];k=e,a&&a.handle&&(f=a.handle);const n=await $();return n||(k=t),n}var R=a(2463),_=(a(7379),a(4678)),D=a(1474),F=a(3681),B=a.n(F);D.ZP.mount(new D.LJ);const q="electron"in window,N=q&&/Windows/.test(navigator.userAgent),H=!!window.showDirectoryPicker,j="/getFile/",U="/getCover/",z="/savePlist/",K=location.origin+location.pathname,W=o.i8,G=q?"/getBackground":"backgrounds",Y=4,V=1e3,X="0",J="1",Z="2",Q="3",ee="4",te="0",ae="1",ne="2",oe="3",se="6",le="7",ie="8",re={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},ce="dual-combined",de="single",ue="gradient",pe="bar-index",fe="bar-level",he="10",me="101",be="1",ge="2",ve="alpha",ye="nobg",ke="barSp",we="imgfit",xe="stereo",Se="colormode",Le="fill",Ee="gradient",Ce="leds",$e="line",Te="lumi",Ae="mirror",Pe="mode",Ie="outline",Oe="peaks",Me="presets",Re="radial",_e="spin",De="reflex",Fe="round",Be="split",qe=1,Ne=-1,He="bark",je="log",Ue="D",ze="custom-grads",Ke="custom-preset",We="disabled-bgfit",Ge="disabled-gradients",Ye="disabled-modes",Ve="disabled-properties",Xe="display-options",Je="force-filesystem",Ze="general-settings",Qe="last-config",et="last-dir",tt="playlists",at="sensitivity-presets",nt="pl_",ot="No description",st=20,lt=document.querySelector.bind(document),it=document.querySelectorAll.bind(document),rt=lt("#alpha_bars"),ct=lt("#analyzer"),dt=lt("#ansi_bands"),ut=lt("#background"),pt=lt("#balance"),ft=lt("#bar_space"),ht=lt("#bg_img_dim"),mt=lt("#bg_img_fit"),bt=lt("#channel_layout"),gt=lt("#color_mode"),vt=lt("#bg_container"),yt=lt("#bg_dim"),kt=lt("#end_timeout"),wt=lt("#fft_size"),xt=lt("#fill_alpha"),St=lt("#fps"),Lt=lt("#freq_scale"),Et=lt("#fs_height"),Ct=lt("#gradient"),$t=lt("#gradientRight"),Tt=lt("#info_timeout"),At=lt("#led_display"),Pt=lt("#linear_amplitude"),It=lt("#line_width"),Ot=lt("#link_grads"),Mt=lt("#loaded_playlist"),Rt=lt("#lo_res"),_t=lt("#lumi_bars"),Dt=lt("#max_fps"),Ft=lt("#mirror"),Bt=lt("#mode"),qt=lt("#mute"),Nt=lt("#no_shadow"),Ht=lt("#note_labels"),jt=lt("#outline"),Ut=lt("#osd"),zt=lt("#pip_ratio"),Kt=lt("#playlists"),Wt=lt("#radial"),Gt=lt("#random_mode"),Yt=lt("#freq_max"),Vt=lt("#freq_min"),Xt=lt("#reflex"),Jt=lt("#repeat"),Zt=lt("#round_bars"),Qt=lt("#save_dir"),ea=lt("#scaleX"),ta=lt("#scaleY"),aa=lt("#sensitivity"),na=lt("#show_count"),oa=lt("#show_cover"),sa=lt("#show_peaks"),la=lt("#show_song"),ia=lt("#smoothing"),ra=lt("#source"),ca=lt("#spin"),da=lt("#split_grad"),ua=lt("#track_timeout"),pa=lt("#video"),fa=lt("#volume"),ha=lt("#warp"),ma=lt("#weighting"),ba=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:te,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:je,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",noteLabels:1,outlineBars:0,radial:0,randomMode:0,reflex:be,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:Ue}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:ae,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:je,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",noteLabels:0,radial:0,randomMode:0,reflex:"0",roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:Ue}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:Z,bgImageDim:.3,bgImageFit:ae,channelLayout:ce,colorMode:ue,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:He,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:me,noteLabels:0,radial:0,randomMode:0,reflex:"0",showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:Ue}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:Z,barSpace:.1,bgImageDim:.3,bgImageFit:oe,channelLayout:de,colorMode:fe,freqMax:2e4,freqMin:20,freqScale:je,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",noteLabels:0,outlineBars:0,radial:1,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:1,splitGrad:0,weighting:Ue}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:le,channelLayout:de,colorMode:pe,freqMax:2e4,freqMin:20,freqScale:je,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:ge,roundBars:1,showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:Ue}},{key:"last",name:"Last session",options:{}},{key:"default",name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:X,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:ae,channelLayout:de,colorMode:ue,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:je,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,mirror:0,mode:"0",noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:"0",repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:1,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""}}],ga={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},va=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:he,text:"Area graph",disabled:!1},{value:me,text:"Line graph",disabled:!1},{value:"8",text:"Octave bands / 10 bands",disabled:!1},{value:"7",text:"1/2 octave / 20 bands",disabled:!1},{value:"6",text:"1/3 octave / 30 bands",disabled:!1},{value:"5",text:"1/4 octave / 40 bands",disabled:!1},{value:"4",text:"1/6 octave / 60 bands",disabled:!1},{value:"3",text:"1/8 octave / 80 bands",disabled:!1},{value:"2",text:"1/12 octave / 120 bands",disabled:!1},{value:"1",text:"1/24 octave / 240 bands",disabled:!1}],ya=[[de,"Singl"],[ce,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],ka=[{value:ve,text:"Alpha",disabled:!1},{value:Pe,text:"Analyzer Mode",disabled:!1},{value:ye,text:"Background",disabled:!1},{value:ke,text:"Bar Spacing",disabled:!1},{value:we,text:"BG Image Fit",disabled:!1},{value:xe,text:"Channel Layout",disabled:!1},{value:Se,text:"Color Mode",disabled:!1},{value:Le,text:"Fill Opacity",disabled:!1},{value:Ee,text:"Gradients",disabled:!1},{value:Ce,text:"LEDs",disabled:!1},{value:$e,text:"Line Width",disabled:!1},{value:Te,text:"Lumi",disabled:!1},{value:Ae,text:"Mirror",disabled:!1},{value:Ie,text:"Outline",disabled:!1},{value:Oe,text:"Peaks",disabled:!1},{value:Re,text:"Radial",disabled:!1},{value:_e,text:"Radial Spin",disabled:!1},{value:De,text:"Reflex",disabled:!1},{value:Fe,text:"Round",disabled:!1},{value:Be,text:"Split",disabled:!1},{value:Me,text:"User Presets",disabled:!0}],wa=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],xa={info:5,track:10,end:0,covers:!0,count:!0},Sa=[{value:te,text:"Adjust",disabled:!1},{value:ae,text:"Center",disabled:!1},{value:oe,text:"Pulse",disabled:!1},{value:ne,text:"Repeat",disabled:!1},{value:se,text:"Warp",disabled:!1},{value:le,text:"Warp Drive",disabled:!1},{value:ie,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],La=[wt,Et,Dt,zt,Qt,ia],Ea={fftSize:8192,fsHeight:100,maxFPS:60,pipRatio:2.35,saveDir:!0,smoothing:.7},Ca=[[30,"30"],[60,"60"],[0,"unlimited"]],$a=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let Ta,Aa,Pa,Ia,Oa,Ma,Ra,_a,Da,Fa,Ba,qa,Na,Ha,ja,Ua,za=[],Ka=[],Wa=[],Ga=null,Ya={},Va=!1,Xa=!1,Ja=!1,Za=0;const Qa=Ut.getContext("2d"),en=new Image,tn=document.createElement("video"),an=(e,t)=>e.replace(/(%2f|\/)/g,t&&N?"\\":"/"),nn=e=>e.replace(/\//g,"%2f"),on=e=>Math.round(100*e)/100,sn=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},ln=e=>{let t="";if(gn(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},rn=e=>gn(e)?e.elements[e.dataset.prop].value:void 0!==e.dataset.active?e.dataset.active:e.value,cn=e=>({alphaBars:rn(rt),ansiBands:rn(dt),background:rn(ut),barSpace:rn(ft),bgImageDim:rn(ht),bgImageFit:rn(mt),channelLayout:rn(bt),colorMode:rn(gt),fillAlpha:rn(xt),freqMax:rn(Yt),freqMin:rn(Vt),freqScale:rn(Lt),gradient:rn(Ct),gradientRight:rn($t),ledDisplay:rn(At),linearAmpl:rn(Pt),lineWidth:rn(It),linkGrads:rn(Ot),loRes:rn(Rt),lumiBars:rn(_t),mirror:rn(Ft),mode:rn(Bt),noShadow:rn(Nt),noteLabels:rn(Ht),outlineBars:rn(jt),radial:rn(Wt),randomMode:rn(Gt),reflex:rn(Xt),repeat:rn(Jt),roundBars:rn(Zt),sensitivity:rn(aa),showFPS:rn(St),showPeaks:rn(sa),showScaleX:rn(ea),showScaleY:rn(ta),showSong:rn(la),spin:rn(ca),splitGrad:rn(da),weighting:rn(ma)}),dn=e=>{const t=+e==e?e:ba.findIndex((t=>t.key==e));return t<0||t>ba.length-1?-1:t},un=e=>{const t=dn(e);return-1==t?{}:ba[t].options},pn=e=>{const t=dn(e);return-1!=t&&ba[t].name},fn=()=>{const e=rn(bt)!=de&&!xn(Ot);return`Gradient${e?"s":""}: ${ga[Ct.value].name+(e?" / "+ga[$t.value].name:"")}`},hn=()=>Ha?(0,_.U2)(tt):Qn(tt),mn=()=>ja.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${yn(e)?'<em class="empty">Empty slot</em>':e.name||ot}`)),bn=e=>e.startsWith("blob:"),gn=e=>"FORM"==e.tagName&&null!=e.dataset.prop,vn=e=>e.startsWith("http")&&!e.startsWith(K),yn=e=>!e||"object"!=typeof e||!Object.keys(e).length,kn=e=>vt.classList.contains("pip"),wn=(e=za[Pa])=>e&&e.currentTime>0&&!e.paused&&!e.ended,xn=e=>"1"==e.dataset.active,Sn=e=>e.replace(/\\/g,"/"),Ln=e=>xn(e)?"ON":"OFF",En=e=>{const t=Pn(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),l=s>=0?o.slice(0,s):o,i=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:l,extension:i}},Cn=e=>{e=e.replace(/_/g," ");const[,,t,a,,n,o]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{artist:n,title:o,duration:","==a?On(t):""}},$n=e=>(q&&!vn(e)&&(e.startsWith(j)&&(e=e.slice(9)),e=j+nn(e)),e),Tn=e=>Da.children.length,An=(e=2)=>Math.random()*e|0,Pn=e=>{const t=new RegExp(`^${j}`);return Sn(an(e.replace(t,"")))},In=e=>{Ha?(0,_.t8)(et,e):qa!=Ne&&xo(et,e)},On=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},Mn=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n};function Rn(e,t=!1){const a=e.map((e=>Fn(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${Tn()<V?"":". Queue is full!"}`;B().alert({text:a,time:5})}))}function _n(e,t){const a=t.dataset,n=e.dataset,o=e.common,s=e.format;if(n)Object.assign(a,n);else if(a.artist=o.artist||a.artist,a.title=o.title||a.title,a.album=o.album?o.album+(o.year?" ("+o.year+")":""):"",a.codec=s?s.codec||s.container:a.codec,s&&(s.bitsPerSample||s.sampleRate&&!s.bitrate)?a.quality=(s.sampleRate?(s.sampleRate/1e3|0)+"KHz":"")+(s.sampleRate&&s.bitsPerSample?" / ":"")+(s.bitsPerSample?s.bitsPerSample+"bits":""):s&&s.bitrate?a.quality=(s.bitrate/1e3|0)+"K "+(s.codecProfile||""):a.quality="",s&&s.duration?a.duration=On(s.duration):a.duration="",o.picture&&o.picture.length){const e=new Blob([o.picture[0].data],{type:o.picture[0].format});a.cover=URL.createObjectURL(e)}t==za[Pa]&&To()}function Dn(e,t={},a){return new Promise((n=>{Tn()>=V&&n(0);let o=Sn(e.file);const s=an(o).split("/").pop(),l=s.split(".").pop(),i=document.createElement("li"),r=i.dataset;Object.assign(r,re),r.artist=t.artist||"",r.title=t.title||s.replace(/%23/g,"#")||o.slice(o.lastIndexOf("//")+2),r.duration=t.duration||"",r.codec=l!==s?l.toUpperCase():"",i.handle=e.handle,o=o.replace(/#/g,"%23"),r.file=o,Da.appendChild(i),r.retrieve=1,go(),!a&&1!=Tn()||wn()?n(1):oo(0,a).then((()=>n(1))),Fa>Tn()-3&&eo()}))}function Fn(e,t=!1){let a;return a=["m3u","m3u8"].includes(En(e.file).extension)?to(e,t):Dn(e,Cn(En(e.file).baseName),t),a.then((e=>{t&&!wn()&&e>0&&co(Tn()-e)})),a}function Bn(e){let t=e?on((+pt.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),Co(t),$o("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),zo()}function qn(e){const t=+Et.value;(1==e&&t<+Et.max||-1==e&&t>+Et.min)&&(Et.value=t+Et.step*e,Oo(Et)),$o(`Analyzer height: ${Et.value}%`)}function Nn(e){let t=on((+fa.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),Ro(t),$o("Volume: "+20*t),zo()}function Hn(e=Pa){const t=za[e],a=t.dataset;Jn(t,null),Object.assign(a,re),t.load(),e==Pa&&To()}function jn(e,t,a){const n=lt("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML=""),t&&lt("#toggle_console").classList.add("warning"),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function Un(e,t){const a=gn(e)?e.elements[e.dataset.prop]:e.options;let n=(gn(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),gn(e)?a[n].checked=!0:e.selectedIndex=n,Oo(e)}function zn(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Kn(){Ga&&Ga.key&&(delete ga[Ga.key],0===Object.keys(ga).filter((e=>!ga[e].disabled)).length&&(ga[Object.keys(ga)[0]].disabled=!1),fo(),po(),wo(ze),wo(Ge),Ga=null,location.href="/#config")}function Wn(e,t){if(yn(ja[e]))return;const a=`User Preset #${e+1}`,n=ja[e].name?"<br>"+ja[e].name:"";t?(ja[e]={},xo(Ke,ja),B().alert({text:`Deleted ${a}`})):B().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{Wn(e,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}})}function Gn(e=1){const t=za[Pa];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),$o(1),t.currentTime=a}"m"==Va&&Lo("m",e)}function Yn(){return clearTimeout(Ia),!!Va&&(Va=!1,!0)}async function Vn(){kn()&&await document.exitPictureInPicture(),Ta.toggleFullscreen(),document.activeElement.blur()}function Xn(e){if("F1"==e.code&&!e.altKey&&!e.ctrlKey)return location.href="#help",void e.preventDefault();if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?qn(1):Nn(1);break;case"ArrowDown":t?qn(-1):Nn(-1);break;case"ArrowLeft":t?Bn(-1):Va?($o("Rewind",1),Gn(-1)):Lo("k",-1);break;case"ArrowRight":t?Bn(1):Va?($o("Fast forward",1),Gn()):Lo("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(mo(!0),Oo(Gt,!1));else if(t){const e=cn();e.randomMode=0,So(a,e)}else ao(a)}else switch(e.code){case"Delete":case"Backspace":Da.querySelectorAll(".selected").forEach((e=>{vo(e),e.remove()}));const e=sn(Da.querySelector(".current"));void 0!==e?Fa=e:Fa>Tn()-1?Fa=Tn()-1:Fa--,Tn()?eo():(Hn(Ra),wn()||Hn());break;case"Space":$o(wn()?"Pause":"Play",1),io();break;case"ArrowLeft":case"KeyJ":Yn()||t||($o("Previous track",1),Fo(!0));break;case"KeyG":Un(Ct,t),$o(fn());break;case"ArrowRight":case"KeyK":Yn()||t||($o("Next track",1),Fo());break;case"KeyA":Un(Gt,t),$o("Randomize: "+ln(Gt)),Oo(Gt);break;case"KeyB":Un(t?mt:ut);const a=ut.value[0];$o("Background: "+ln(ut)+(a>1&&a<7?` (${ln(mt)})`:""));break;case"KeyC":Wt.click(),$o("Radial "+Ln(Wt));break;case"KeyD":Ho();break;case"KeyE":Tn()>0&&(Do(),$o("Shuffle"));break;case"KeyF":Vn();break;case"KeyH":St.click();break;case"KeyI":la.click(),$o("Song info display "+Ln(la));break;case"KeyL":At.click(),$o("LED effect "+Ln(At));break;case"KeyM":case"KeyV":Un(Bt,t),$o("Mode: "+ln(Bt));break;case"KeyN":Un(aa,t),$o(ln(aa).toUpperCase()+" sensitivity");break;case"KeyO":Rt.click(),$o((xn(Rt)?"LOW":"HIGH")+" Resolution");break;case"KeyP":sa.click(),$o("Peaks "+Ln(sa));break;case"KeyR":Jt.click(),$o("Queue repeat "+Ln(Jt));break;case"KeyS":$o("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+ea.dataset.active+(ta.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),ea.dataset.active=1&t,ta.dataset.active=t>>1,Oo([ea,ta]),t}(t)]);break;case"KeyT":Nt.click(),$o((xn(Nt)?"Flat":"Shadowed")+" text mode");break;case"KeyU":_t.click(),$o("Luminance bars "+Ln(_t));break;case"KeyX":Un(Xt,t),$o("Reflex: "+ln(Xt));break;default:return}e.preventDefault()}function Jn(e,t){const a=e.src||"";bn(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src")}function Zn(e,t,a){return new Promise((n=>{Jn(t,URL.createObjectURL(e)),t.onloadeddata=()=>{a&&t.play(),n(!0)}}))}async function Qn(e){return JSON.parse(q?await electron.api("storage-get",e):localStorage.getItem(e))}async function eo(){const e=Fa<Tn()-1?Fa+1:0,t=Da.children[e],a=za[Ra];t&&(_n(t,a),t.handle?(await t.handle.requestPermission(),t.handle.getFile().then((e=>Zn(e,a))).then((()=>a.load()))):(Jn(a,t.dataset.file),a.load())),Ja=!1}function to(e,t=!1){let a=Sn(e.file);return new Promise((async n=>{let o=[];const s=()=>{Promise.all(o).then((e=>{const t=e.reduce(((e,t)=>e+t),0);n(t)}))},l=async e=>{let n;Mt.dataset.path||Io(a),a=En(a).path;for(let s of e.split(/[\r\n]+/))if("#"!=s.charAt(0)&&""!=s.trim()){let e;s=Sn(s),n||(n=En(s).baseName),vn(s)||(Ha&&(e=await P(s),e||jn(`Cannot resolve file handle for ${s}`,!0)),":"!=s[1]&&"/"!=s[0]&&(s=a+s)),o.push(Dn({file:$n(s),handle:e},Cn(n),t)),t=!1,n=""}else s.startsWith("#EXTINF")&&(n=s.slice(8));s()};if(a)if(["m3u","m3u8"].includes(En(a).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(l).catch((e=>{jn(e,!0),n(0)})):fetch(a).then((e=>{if(200==e.status)return e.text();jn(`Fetch returned error code ${e.status} for URI ${a}`,!0)})).then(l).catch((e=>{jn(e,!0),n(0)}));else{const e=nt+a,t=Ha?await(0,_.U2)(e):await Qn(e);Array.isArray(t)?(t.forEach((e=>{const t=Sn(e.file||e),a=e.handle;o.push(Dn({file:t,handle:a},Cn(En(t).baseName)))})),s()):(jn(`Unrecognized playlist file: ${a}`,!0),n(0))}else n(-1)}))}function ao(e,t=!0,a,n){const o=+e==e,s=o?ja[e].options:un(e),l=un("default");yn(s)||(t&&jn("Loading "+(o?"User Preset #"+(e+1):"'"+pn(e)+"' preset")),void 0!==s.stereo&&(s.channelLayout=ya[+s.stereo][0]),it("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==s[t]?s[t]:a?l[t]:void 0;if(void 0!==o&&(e!=Gt||!n))if(gn(e)){const t=e.querySelector(`[value="${o}"]`);t&&(t.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+o:e==fa?Ro(o):e==pt?Co(o):(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),Ko(e))})),Ta.setOptions({alphaBars:xn(rt),ansiBands:xn(dt),colorMode:rn(gt),fftSize:rn(wt),frequencyScale:rn(Lt),ledBars:xn(At),linearAmplitude:xn(Pt),loRes:xn(Rt),lumiBars:xn(_t),maxFPS:rn(Dt),maxFreq:rn(Yt),minFreq:rn(Vt),mirror:rn(Ft),noteLabels:xn(Ht),outlineBars:xn(jt),radial:xn(Wt),roundBars:xn(Zt),showFPS:xn(St),showPeaks:xn(sa),showScaleX:xn(ea),showScaleY:xn(ta),smoothing:rn(ia),spinSpeed:rn(ca),splitGradient:xn(da),weightingFilter:rn(ma)}),Oo([ut,mt,ht,bt,Et,Ot,aa,Xt,Ct,$t,...n?[]:[Gt],ft,Bt]),"demo"==e&&mo(!0),t&&B().alert({text:"Settings loaded!"}))}async function no(e){zn(Kt);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,Kt.options[Kt.options.length]=t;const a=await hn();a&&Object.keys(a).forEach((t=>{const n=new Option(a[t],t);n.dataset.isLocal="1",t==e&&(n.selected=!0),Kt.options[Kt.options.length]=n})),fetch("playlists.cfg").then((e=>200==e.status&&(jn("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(Kt.options[Kt.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?jn(`${t} playlists loaded from playlists.cfg`):jn("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function oo(e,t){return new Promise((async a=>{const n=za[Pa],o=()=>{jo(),eo(),a(!0)};if(Da.children[e]){Fa=e;const a=Da.children[Fa];_n(a,n),a.handle?(await a.handle.requestPermission(),a.handle.getFile().then((e=>Zn(e,n,t))).then((()=>o()))):(Jn(n,a.dataset.file),n.onloadeddata=()=>{t&&n.play(),o()})}else a(!1)}))}function so(){Ga={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(ga).some((e=>e===Ga.key))&&e<10;)Ga.key=`custom-gradient-${e}`,e++;bo(),lt("#btn-save-gradient").innerText="Add",lt("#btn-delete-gradient").style.display="none",location.href="/#gradient-editor"}function lo(e){if(Ja||Oa||Fa>Tn()-1)return!0;if(Ja=!0,Fa<Tn()-1)Fa++;else{if(!xn(Jt))return Ja=!1,!1;Fa=0}return e|=wn(),Pa=Ra,Ra=0|!Pa,To(),e?za[Pa].play().then((()=>eo())).catch((e=>{e.code!=st&&(jn(e,!0),eo(),lo(!0))})):eo(),jo(),!0}function io(e){Oa||(wn()&&!e?(za[Pa].pause(),kn()&&tn.pause()):za[Pa].play().catch((e=>{e.code!=st&&(jn(e,!0),lo(!0))})))}function ro(){let e=!0;return wn()?za[Pa].currentTime>2?za[Pa].currentTime=0:Fa>0?co(Fa-1):e=!1:e=oo(Fa-1),e}function co(e){oo(e,!0)}function uo(e,t){const a=!Array.isArray(t[0]);for(const n of a?t.filter((e=>!e.disabled)):t){const t=e.dataset.prop,a=n.text||n[1],o=n.value||n[0],s=t+"-"+o,l=document.createElement("input"),i=document.createElement("label");l.name=t,l.id=s,l.type="radio",l.value=o,i.htmlFor=s,i.innerText=a,e.append(l,i)}}function po(){const e=lt("#enabled_gradients");zn(e),Object.keys(ga).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ga[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${ga[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ga[t].disabled?"":"checked"}>\n                   ${ga[t].name}\n                </label>`})),it(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(ga).reduce(((e,t)=>e+!ga[t].disabled),0)<2)return B().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;ga[e.dataset.grad].disabled=!e.checked,fo(),wo(Ge)}))})),it(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!ga[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=ga[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});Ga=a}(e.target.getAttribute("data-grad")),bo(),lt("#btn-save-gradient").innerText="Save",lt("#btn-delete-gradient").style.display="block",location.href="/#gradient-editor"}))}))}function fo(){for(const e of[Ct,$t]){let t=e.value;zn(e);for(const t of Object.keys(ga))ga[t].disabled||(e.options[e.options.length]=new Option(ga[t].name,t));""!==t&&(e.value=t,Oo(e))}}function ho(e,t,a){const n=e.value,o=!Array.isArray(t[0]);a||zn(e);for(const a of o?t.filter((e=>!e.disabled)):t){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),e[e.options.length]=t}""!==n&&(e.value=n,-1==e.selectedIndex&&(e.selectedIndex=0),Oo(e))}function mo(e=Oa){if(!wn()&&!e)return;const t=e=>!ka.find((t=>t.value==e)).disabled,a=(e,t=!0,a=(()=>!0))=>{let o=9;do{if(gn(e)){const t=e.elements[e.dataset.prop];t[An(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=An();else if(e.step){const{min:t,max:a,step:n}=e,o=An((a-t)/n+1)*n+ +t;e.value=(10*o|0)/10,Ko(e)}else e.selectedIndex=An(e.options.length)}while(!a(rn(e))&&o--);t&&n.push(e)};let n=[];if(t(Me)){const e=ja.map(((e,t)=>yn(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&ao(e[An(t)],!1,!1,!0)}if(t(Pe)&&a(Bt),t(ve)&&a(rt),t(ye)&&a(ut,!1),t(we)&&a(mt),t(xe)&&a(bt,!0,(e=>e!=ce)),t(Se)&&a(gt),t(Oe)&&a(sa),t(Ce)&&a(At),t(Te)&&a(_t,!0,(e=>!e||ut.value[0]<=1||!xn(At))),t($e)&&a(It,!1),t(Le)&&a(xt,!1),t(ke)&&a(ft,!1),t(Ie)&&a(jt),t(De)&&a(Xt,!1,(e=>e!=ge||!xn(At))),t(Re)&&a(Wt),t(Fe)&&a(Zt),t(_e)&&a(ca),t(Be)&&a(da),t(Ae)&&a(Ft),t(Ee))for(const e of[Ct,...xn(Ot)?[]:[$t]])a(e);n.push(ut,Xt,Bt),Oo(n)}function bo(){if(null==Ga)throw new Error("Current gradient must be set before editing gradient");const e=lt("#grad-color-table");zn(e),lt("#new-gradient-name").value=Ga.name,lt("#new-gradient-horizontal").checked="h"===Ga.dir;const t=lt("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),Ga.colorStops.forEach(((e,t)=>{!function(e,t){const a=lt("#grad-color-table"),n=lt("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),l=n.querySelector(".grad-color-stop"),i=n.querySelector(".grad-add-stop"),r=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,l.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,Ga.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,Ga.colorStops[e].color=o.value})),l.addEventListener("input",(t=>{Ga.colorStops[e].pos=parseFloat(t.target.value)})),i.addEventListener("click",(()=>{Ga.colorStops.splice(e+1,0,{pos:(()=>{if(e===Ga.colorStops.length-1){const e=Ga.colorStops[Ga.colorStops.length-1].pos;return Ga.colorStops[Ga.colorStops.length-1].pos=(Ga.colorStops[Ga.colorStops.length-2].pos+e)/2,e}return(Ga.colorStops[e].pos+Ga.colorStops[e+1].pos)/2})(),color:"#111111"}),bo()})),2===Ga.colorStops.length?r.setAttribute("disabled","true"):r.addEventListener("click",(()=>{Ga.colorStops.splice(e,1),bo()})),n.removeAttribute("id"),a.appendChild(n)}(t,Ga.colorStops[t])})),lt("#new-gradient-bkgd").value=Ga.bgColor}async function go(){if(Za>=Y)return;const e=Array.from(Da.children).find((e=>e.dataset.retrieve));if(e){const t=e.dataset.file,a=a=>{a&&(_n(a,e),No(e),e.handle||a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=En(e).path;if(qa==Ne||vn(e))t("");else if(void 0!==Ya[a])t($n(a+Ya[a]));else{const e=qa==qe?U+nn(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let n="";if(e)if(qa==qe)n=e;else{const t=O(e);t.cover&&(n=t.cover)}Ya[a]=n,t($n(a+n))}))}}))}(t).then((t=>{e.dataset.cover=t,No(e)})))},n=()=>{Za--,go()};Za++,delete e.dataset.retrieve,e.handle?(await e.handle.requestPermission(),e.handle.getFile().then((e=>{R.Aj(e).then(a).catch((e=>{}))})).catch((e=>{})).finally(n)):R.eF(t,{skipPostHeaders:!0}).then(a).catch((e=>{})).finally(n)}}function vo(e){const t=e.dataset.cover;bn(t)&&URL.revokeObjectURL(t)}function yo(){null!==Ga&&(ga[Ga.key]=Ga,Ta.registerGradient(Ga.key,Ga),fo(),po(),wo(ze),Ga=null,location.href="/#config")}function ko(e,t){if(0==Tn())return void B().alert({text:"Queue is empty!"});if(!e)return void B().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?ko(T(e,!0)):B().alert({text:"Canceled"})},cancelCallback:()=>{B().alert({text:"Canceled"})}});const a=[];Da.childNodes.forEach((e=>{const{file:t,artist:n,title:o,duration:s}=e.dataset;a.push({file:Pn(t),artist:n,title:o,duration:s})})),fetch(z+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const n=e?`${t?"Updated":"Saved as"} ${En(e).fileName}`:a;B().alert({text:n}),Io(e),$(null,v.scrollTop)}))}function wo(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Ye||xo(Ye,t(va)),e&&e!=We||xo(We,t(Sa)),e&&e!=Ge||xo(Ge,Object.keys(ga).map((e=>({value:e,disabled:ga[e].disabled})))),!e||e==ze){const e={};Object.keys(ga).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=ga[t])),xo(ze,e)}if(e&&e!=Ve||xo(Ve,t(ka)),!e||e==at){let e=[];for(const t of[0,1,2])e.push({min:lt(`.min-db[data-preset="${t}"]`).value,max:lt(`.max-db[data-preset="${t}"]`).value,boost:lt(`.linear-boost[data-preset="${t}"]`).value});xo(at,e)}if(!e||e==Xe){const e={info:Tt.value,track:ua.value,end:kt.value,covers:oa.checked,count:na.checked};xo(Xe,e)}if(!e||e==Ze){const e={fftSize:wt.value,fsHeight:Et.value,maxFPS:Dt.value,pipRatio:zt.value,saveDir:Qt.checked,smoothing:ia.value};xo(Ze,e)}}function xo(e,t){const a=JSON.stringify(t);q?electron.api("storage-set",e,a):localStorage.setItem(e,a)}function So(e,t,a,n){const o=`User Preset #${e+1}`,s=ja[e].name||"",l=Ta.isFullscreen;if(!yn(ja[e])&&!n&&Xa!==e)return void(l?($o(`Overwrite ${o} - Press again to confirm!`,5),Xa=e,setTimeout((()=>{Xa===e&&(Xa=!1)}),5e3)):B().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{So(e,t,a,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}}));if(Xa=!1,!a||!`${a}`.trim()){if(!l)return void B().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{So(e,t,a.trim()||ot,!0)},cancelCallback:()=>{B().alert({text:"Save canceled!"})}});a=""}a==ot&&(a=""),ja[e]={name:a,options:t},xo(Ke,ja);const i=`Saved to ${o}`;l?$o(i,5):B().alert({text:i})}function Lo(e,t=1){Ia=setTimeout((()=>{Va=e,Gn(t)}),200)}function Eo(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function Co(e){pt.dataset.value=e,_a&&(_a.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),pt.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function $o(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(Aa.info=e,Aa.startTime=n,Aa.endTime=Math.max(o,Aa.endTime||0),Aa.fade=t==1/0?0:t/3*a):(Aa.msg=e,2==Aa.info&&(Aa.info=1),Aa.msgTimer=o)}else Aa={endTime:0,msgTimer:0}}function To(){en.src=za[Pa].dataset.cover,ut.value==Z&&Eo(en.src)}function Ao(e){wt.value=e.fftSize,Et.value=e.fsHeight,Dt.value=e.maxFPS,zt.value=e.pipRatio,Qt.checked=e.saveDir,ia.value=e.smoothing}function Po(e){Tt.value=e.info,ua.value=e.track,kt.value=e.end,oa.checked=e.covers,na.checked=e.count}function Io(e=""){q&&(e=Pn(e),Mt.dataset.path=nn(e),Mt.innerText=En(e).fileName,Mt.title=an(e,!0))}function Oo(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>$t.style.display=rn(bt)==de||xn(Ot)?"none":"";for(const o of e){switch(o){case rt:Ta.alphaBars=xn(rt);break;case dt:Ta.ansiBands=xn(dt);break;case ut:const e=ut.value[0],t=e!=X&&e!=J;let s=ut.value.slice(1);Ta.overlay=t,Ta.showBgColor=e==X,e==ee?(Eo(),pa.style.display="",s||(s=Wa[An(Wa.length)]),decodeURIComponent(pa.src).endsWith(s)||(pa.src=G+"/"+encodeURIComponent(s))):(pa.style.display="none",t?(e!=Q||s||(s=Ka[An(Ka.length)]),s&&(s=G+"/"+encodeURIComponent(s)),Eo(s||en.src)):Eo());break;case mt:const l=mt.value,i=l==se||l==le||l==ie;vt.classList.toggle("repeat",l==ne),vt.classList.toggle("cover",l==te||i),vt.style.backgroundSize="",ha.style.display=i?"":"none",ha.classList.toggle("rotating",l==ie),ha.classList.toggle("paused",l==se);break;case ht:yt.style.background=`rgba(0,0,0,${1-ht.value})`;break;case ft:Ta.barSpace=Ta.isLumiBars?1.5:rn(ft);break;case bt:Ta.channelLayout=rn(bt),a();break;case gt:Ta.colorMode=rn(gt);break;case xt:Ta.fillAlpha=Bt.value==he?1:xt.value;break;case wt:Ta.fftSize=wt.value,jn("FFT size is "+Ta.fftSize+" samples");break;case Lt:Ta.frequencyScale=rn(Lt);break;case Et:ct.style.height=`${Et.value}%`;break;case Vt:case Yt:for(;+Yt.value<=+Vt.value;)Yt.selectedIndex++;Ta.setFreqRange(Vt.value,Yt.value);break;case Ct:case $t:""===o.value&&(o.selectedIndex=0),xn(Ot)?Ta.gradient=Ct.value=$t.value=o.value:Ta[o==Ct?"gradientLeft":"gradientRight"]=o.value;break;case At:Ta.ledBars=xn(At);break;case Pt:Ta.linearAmplitude=xn(Pt);break;case It:Ta.lineWidth=Bt.value==he?0:It.value;break;case Ot:a(),xn(Ot)&&Oo(Ct,!1);break;case Rt:Ta.loRes=xn(Rt);break;case _t:Ta.lumiBars=xn(_t),Oo(ft,!1);break;case Dt:Ta.maxFPS=Dt.value;break;case Bt:const r=Bt.value;[he,me].includes(r)?Ta.mode=10:Ta.mode=r,r==he?(Ta.lineWidth=0,Ta.fillAlpha=1):(Ta.lineWidth=It.value,Ta.fillAlpha=xt.value),Oo(ft,!1);break;case Ft:Ta.mirror=rn(Ft);break;case Ht:Ta.noteLabels=xn(Ht);break;case jt:Ta.outlineBars=xn(jt);break;case zt:kn()&&(Ta.width=Ta.height*zt.value);break;case Wt:Ta.radial=xn(Wt),Oo(ft,!1);break;case Gt:const c=Gt.value;Ba&&(Ba=clearInterval(Ba)),c>1&&(Ba=setInterval(mo,2500*c));break;case Xt:switch(rn(Xt)){case be:Ta.reflexRatio=.4,Ta.reflexAlpha=.2;break;case ge:Ta.reflexRatio=.5,Ta.reflexAlpha=1;break;default:Ta.reflexRatio=0}break;case Zt:Ta.roundBars=xn(Zt);break;case Qt:Qt.checked?In(k):((0,_.IV)(et),n=et,q?electron.api("storage-remove",n):localStorage.removeItem(n));case ea:Ta.showScaleX=xn(ea);break;case ta:Ta.showScaleY=xn(ta);break;case aa:const d=rn(aa);Ta.setSensitivity(lt(`.min-db[data-preset="${d}"]`).value,lt(`.max-db[data-preset="${d}"]`).value),Ta.linearBoost=lt(`.linear-boost[data-preset="${d}"]`).value;break;case St:Ta.showFPS=xn(St);break;case sa:Ta.showPeaks=xn(sa);break;case ia:Ta.smoothing=ia.value,jn("smoothingTimeConstant is "+Ta.smoothing);break;case ca:Ta.spinSpeed=ca.value;break;case da:Ta.splitGradient=xn(da);break;case ma:Ta.weightingFilter=rn(ma)}t&&(La.includes(o)?wo(Ze):zo())}var n}async function Mo(){Oa=ra.checked,Oa?q&&!await electron.api("ask-for-media-access")||!navigator.mediaDevices?(jn("Cannot access user microphone",!0),ra.checked=Oa=!1):navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Ma=Ta.audioCtx.createMediaStreamSource(e),wn()&&za[Pa].pause(),Ua=qt.checked,Uo(!0),Ta.connectInput(Ma),jn("Audio source set to microphone")})).catch((e=>{jn(`Could not change audio source - ${e}`,!0),ra.checked=Oa=!1})):(Ma&&(Ta.disconnectInput(Ma),Ma.mediaStream.getTracks()[0].stop(),Ma=null,Uo(Ua)),jn("Audio source set to built-in player"))}function Ro(e){fa.dataset.value=e,Ta.volume=e**2.5,fa.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function _o(){const e=lt("#toggle_settings");e.addEventListener("click",(()=>{lt("#settings").classList.toggle("active",e.classList.toggle("active"))})),lt(".settings-close").addEventListener("click",(()=>e.click()));const t=lt("#toggle_console");let a;t.addEventListener("click",(()=>{lt("#console").classList.toggle("active",t.classList.toggle("active")),t.classList.remove("warning"),jn()})),lt("#console-close").addEventListener("click",(()=>t.click())),lt("#console-clear").addEventListener("click",(()=>jn("Console cleared.",!1,!0))),it(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,Oo(e)}))})),it("[data-prop]").forEach((e=>{gn(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>Oo(e)))})):e.addEventListener("change",(()=>{Oo(e),Ko(e)}))})),ra.addEventListener("change",Mo),qt.addEventListener("change",(()=>Uo())),[fa,pt].forEach((e=>{e.addEventListener("wheel",(t=>{if(t.preventDefault(),a)return;a=setTimeout((()=>a=!1),50);const n=Math.sign(t.deltaY||0);e==fa?Nn(n):Bn(n)}))})),pt.addEventListener("dblclick",(()=>{Bn(0)})),lt("#btn_play").addEventListener("click",(()=>io())),lt("#btn_stop").addEventListener("click",Bo),lt("#btn_shuf").addEventListener("click",Do),lt("#btn_prev").addEventListener("mousedown",(()=>Lo("m",-1))),lt("#btn_prev").addEventListener("click",(e=>{Yn()||Fo(!0)})),lt("#btn_next").addEventListener("mousedown",(()=>Lo("m"))),lt("#btn_next").addEventListener("click",(()=>{Yn()||Fo()})),lt("#load_preset").addEventListener("click",(()=>{const e=[];ba.forEach((t=>{yn(t.options)||e.push({text:t.name+("default"==t.key?" (warning: resets Volume!)":""),handler:()=>ao(t.key)})})),e.push({text:"<strong>USER PRESETS →</strong>",handler:()=>{const e=[];mn().forEach(((t,a)=>{e.push({text:t,handler:()=>ao(a)})})),B().select({text:"LOAD PRESET:",choices:e})}}),B().select({text:"LOAD PRESET:",choices:e})})),lt("#btn_save").addEventListener("click",(()=>{const e=[];mn().forEach(((t,a)=>{const n=ja[a].options;e.push({type:1,text:t,handler:()=>So(a,cn())},{type:2,text:yn(n)?"":'<button title="Edit name">&#xf11f;</button>',handler:()=>So(a,n,"",!0)},{type:2,text:yn(n)?"":'<button title="Delete preset">&#xf120;</button>',handler:()=>Wn(a)})})),B().select({text:"<strong>Click slot to SAVE - Use buttons to Edit or Delete</strong>",choices:e})})),lt("#btn_fullscreen").addEventListener("click",Vn),lt("#save_playlist").addEventListener("click",(()=>{if(q){const e=Mt.dataset.path;e?B().confirm({text:`<strong>${Mt.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>ko(e,!0),cancelCallback:()=>B().alert({text:"Canceled"})}):ko()}else e=Kt.selectedIndex,""==Kt[e].value?qo():Kt[e].dataset.isLocal?B().confirm({text:`Overwrite "${Kt[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{qo(Kt[e].value)},cancelCallback:()=>{B().alert({text:"Canceled"})}}):B().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),lt("#create_playlist").addEventListener("click",(()=>q?ko():qo())),lt("#btn_clear").addEventListener("click",(()=>{!function(){for(;Da.hasChildNodes();)vo(Da.removeChild(Da.firstChild));wn()?Fa=-1:(Fa=0,Hn(Pa)),Hn(Ra),jo()}(),Io()})),(q?lt(".playlist-bar"):Mt).style.display="none",q||(lt("#load_playlist").addEventListener("click",(()=>{to({file:Kt.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;B().alert({text:t,time:5})}))})),lt("#delete_playlist").addEventListener("click",(()=>{return e=Kt.selectedIndex,void(Kt[e].dataset.isLocal?B().confirm({text:`Do you really want to DELETE the "${Kt[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=Kt[e].value,a=nt+t,n=await hn();n&&delete n[t],Ha?((0,_.IV)(a),await(0,_.t8)(tt,n)):(localStorage.removeItem(a),xo(tt,n)),B().alert({text:"Playlist deleted"}),no()},cancelCallback:()=>{B().alert({text:"Canceled"})}}):Kt[e].value&&B().alert({text:"Cannot delete a server playlist!"}));var e}))),Ut.addEventListener("click",(()=>Ho()));const n=lt("#btn_toggle_filesystem");(Na||Ha)&&H?(n.innerText="Use "+(Ha?"server":"local")+" music",n.addEventListener("click",(()=>{xo(Je,!Ha),location.href=K}))):n.style.display="none";const o=lt("#btn_add_selected"),s=lt("#btn_add_folder");q||Na||Ha?(o.addEventListener("mousedown",(()=>Rn(A(".selected")))),s.addEventListener("click",(()=>Rn(A())))):(o.style.display="none",s.style.display="none");const l=lt("#local_file");let i,r;q||H?l.parentElement.style.display="none":l.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){Hn();const e=za[Pa];Zn(t,e,!0),R.Aj(t).then((t=>_n(t,e))).catch((e=>{}))}}(e.target))),lt("#btn_load_url").addEventListener("click",(()=>{B().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&Fn({file:e},!0)}})}));const c=lt("#btn_pip");document.pictureInPictureEnabled?c.addEventListener("click",(async()=>{if(tn!==document.pictureInPictureElement){const e=Ta.canvas.captureStream();i=e.getTracks()[0],tn.muted=!0,tn.srcObject=e,await tn.play(),tn.requestPictureInPicture()}else document.exitPictureInPicture()})):c.classList.add("disabled");const d=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>Ta.setCanvasSize(r.width,r.height)));tn.addEventListener("enterpictureinpicture",(e=>{r=e.pictureInPictureWindow,vt.classList.add("pip"),c.classList.add("active"),Ta.setCanvasSize(r.height*zt.value,r.height),r.addEventListener("resize",d)})),tn.addEventListener("leavepictureinpicture",(()=>{r.removeEventListener("resize",d),tn.pause(),i.stop(),tn.srcObject=i=null,c.classList.remove("active"),vt.classList.remove("pip"),Ta.setCanvasSize()}));const u=navigator.mediaSession;u&&(u.setActionHandler("play",(()=>io())),u.setActionHandler("pause",(()=>io())),u.setActionHandler("previoustrack",(()=>ro())),u.setActionHandler("nexttrack",(()=>lo()))),lt("#add-gradient").addEventListener("click",so),lt("#btn-save-gradient").addEventListener("click",yo),lt("#btn-delete-gradient").addEventListener("click",Kn),lt("#new-gradient-bkgd").addEventListener("input",(e=>{Ga.bgColor=e.target.value})),lt("#new-gradient-name").addEventListener("input",(e=>{Ga.name=e.target.value})),lt("#new-gradient-horizontal").addEventListener("input",(e=>{Ga.dir=e.target.checked?"h":void 0}))}function Do(){for(let e=Tn()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=Da.replaceChild(Da.children[t],Da.children[e]);Da.insertBefore(a,Da.children[t])}co(0)}function Fo(e=!1){(e?ro():lo())||$o(`Already at ${e?"first":"last"} track`)}function Bo(){za[Pa].pause(),$o(),oo(0)}async function qo(e,t=!0){if(0!=Tn())if(e){if(e){let a=e;if(!t){a=a.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=a.toLowerCase().replace(/[^a-z0-9]/g,"_");const t=await hn()||{};for(;t.hasOwnProperty(a);)a+="_1";t[a]=e,Ha?await(0,_.t8)(tt,t):xo(tt,t),no(a)}let n=[];for(const e of Da.childNodes)n.push(Ha?{file:e.dataset.file,handle:e.handle}:e.dataset.file);const o=nt+a;Ha?await(0,_.t8)(o,n):xo(o,n),B().alert({text:"Playlist saved!"})}}else B().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&qo(e,!1)},cancelCallback:()=>{B().alert({text:"Canceled"})}});else B().alert({text:"Queue is empty!"})}function No(e){for(const t of za)t.dataset.file==e.dataset.file&&_n(e,t)}function Ho(){Aa.endTime<performance.now()&&(Aa.info=0),2==Aa.info?$o():$o(1+(0|Aa.info),+Tt.value||1/0)}function jo(){const e=Da.querySelector(".current"),t=Da.children[Fa];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function Uo(e){void 0!==e?qt.checked=e:e=qt.checked,e?Ta.disconnectOutput():Ta.connectOutput()}function zo(){xo(Qe,{...cn(),volume:fa.dataset.value,balance:pt.dataset.value})}function Ko(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){let e,t,a,o,s,d,u,A,P,O,R,F,N;const j=e=>{lo(!0)||(oo(0),$o("Queue ended",10),kn()&&tn.pause())},U=e=>{e.target.attributes.src&&jn("Error loading "+e.target.src,!0)},z=e=>{za[Pa].attributes.src?(kn()&&tn.play(),za[Pa].currentTime<.1&&"1"==Gt.value&&mo(!0),xn(la)&&$o(1,+ua.value||1/0)):co(Fa)};window.addEventListener("error",(e=>jn(`Unexpected ${e.error}`,!0)));let Y=!1;jn(`audioMotion v${W} initializing...`),jn(`User agent: ${navigator.userAgent}`),lt("#version").innerText=W,q&&jn(`Reading user preferences from ${await electron.api("storage-info")}`);const V=await async function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},t=await Qn(Qe),a=null!==t;((e,t)=>{const a=dn("last");-1!=a&&(ba[a].options=t)})(0,{...un("default"),...t}),ja=await Qn(Ke)||[],Array.isArray(ja)||(ja=[{name:"Custom",options:ja}]);for(let e=0;e<9;e++)void 0===ja[e]?ja[e]={}:yn(ja[e])||ja[e].options||(ja[e]={options:ja[e]});e(await Qn(Ye),va),e(await Qn(We),Sa);const n=await Qn(ze);n&&Object.keys(n).forEach((e=>{ga[e]=n[e]})),e(await Qn(Ge),ga),e(await Qn(Ve),ka);const o=it(".min-db");o.forEach((e=>Mn(e,-120,-60)));const s=it(".max-db");s.forEach((e=>Mn(e,-50,0)));const l=it(".linear-boost");l.forEach((e=>Mn(e,1,5,.2))),(await Qn(at)||wa).forEach(((e,t)=>{o[t].value=e.min,s[t].value=e.max,l[t].value=e.boost||wa[t].boost})),Po({...xa,...await Qn(Xe)||{}});for(let e=10;e<16;e++)wt[wt.options.length]=new Option(2**e);return Mn(ia,0,.9,.1),ho(zt,$a),Mn(Et,25,100,5),ho(Dt,Ca),Ao({...Ea,...await Qn(Ze)||{}}),a}();Da=lt("#playlist"),Da.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(co(sn(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),Fa=0,D.ZP.create(Da,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{Fa=sn(Da.querySelector(".current")),0!=e.newIndex||wn()||oo(0),eo()}}),jn(`Instantiating audioMotion-analyzer v${n.Z.version}`),Ta=new n.Z(ct,{fsElement:vt,onCanvasDraw:(n,l)=>{const i=za[Pa],r=i.dataset,c=i.duration-i.currentTime,p=+kt.value,f=ut.value[0],h=mt.value,m=xn(Nt),b=Ta.pixelRatio,{timestamp:g}=l;if(c<.1&&lo(!0),p>0&&c<=p&&xn(la)&&g>Aa.endTime&&wn()&&$o(1,c,1),!(h!=oe&&"4"!=h&&"5"!=h||f!=Z&&f!=Q)){let e;if(h==oe)e=(70*Ta.getEnergy()|0)-25;else{const t=i.currentTime/i.duration;e=100*("4"==h?t:1-t)}vt.style.backgroundSize=`auto ${100+e}%`}Ut.width|=0;const{endTime:v,startTime:y,msgTimer:k,info:w,msg:x,fade:S}=Aa;if(g>v&&g>k)return;const L=(e,t,a,n)=>{m?(Qa.strokeText(e,t,a,n),Qa.fillText(e,t,a,n)):(Qa.shadowOffsetX=Qa.shadowOffsetY=3*b,Qa.fillText(e,t,a,n),Qa.shadowOffsetX=Qa.shadowOffsetY=0)};if(Qa.lineWidth=4*b,Qa.lineJoin="round",Qa.font=F,Qa.textAlign="center",Qa.fillStyle="#fff",Qa.strokeStyle=Qa.shadowColor="#000",k>g&&(g>v||2!=w)){const e=(k-g)/1e3;Qa.globalAlpha=e>1?1:e,L(Aa.msg,a,s)}if(v>g){if(S<0){const e=(v-g)/1e3;Qa.globalAlpha=e>-S?1:e/-S}else{const e=Math.max(0,(g-y)/1e3);Qa.globalAlpha=e>S?1:e/S}if(2==Aa.info&&(L(fn(),a,s,O),Qa.textAlign="left",L(ln(Bt),e,s,O),L(`Randomize: ${ln(Gt)}`,e,d,O),Qa.textAlign="right",L(ln(aa).toUpperCase()+" sensitivity",o,s,O),L(`Repeat is ${Ln(Jt)}`,o,d,O)),Oa)Qa.textAlign="left",Qa.font=N,L("MIC source",e,A,R);else{Qa.textAlign="right",L(r.codec,o,u),L(r.quality,o,u+e);const a=Tn();a&&na.checked&&L(`Track ${(""+(Fa+1)).padStart((""+a).length,"0")} of ${a}`,o,u-e),Qa.textAlign="left",L(r.artist.toUpperCase(),e,u,R),Qa.font=`italic ${F}`,L(r.album,e,P,R),Qa.font=N,L(i.src?r.title:"No song loaded",e,A,R),(i.duration||r.duration)&&(r.duration||(r.duration=On(i.duration),Da.children[Fa]&&(Da.children[Fa].dataset.duration=r.duration)),Qa.textAlign="right",L(On(i.currentTime)+" / "+r.duration,o,P)),en.width&&oa.checked&&Qa.drawImage(en,e,u-1.3*t,t,t)}}},onCanvasResize:(n,l)=>{let i;const r=l.pixelRatio,c=Ut.width=vt.clientWidth*r,p=Ut.height=vt.clientHeight*r;switch(n){case"create":jn(`Display resolution: ${l.fsWidth} x ${l.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),i="Canvas created";break;case"lores":i=`Lo-res ${l.loRes?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":i=(l.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"resize":i="Window resized";break;case"user":i=(kn()?"Resized for":"Closed")+" PIP"}jn(`${i||n}. Canvas size is ${l.canvas.width} x ${l.canvas.height} px`),e=Math.min(c,p)/17,t=3*e,a=c/2,o=c-e,s=1.4*e,d=1.8*s,O=c/3-e,u=p-4*e,A=p-2.8*e,P=p-1.6*e,R=c-7*e,F=`bold ${.7*e}px sans-serif`,N=`bold ${e}px sans-serif`}});const te=Ta.audioCtx;te.createStereoPanner&&(_a=te.createStereoPanner(),Ta.connectInput(_a)),Pa=0,Ra=1;for(const e of[0,1])za[e]=lt(`#player${e}`),Hn(e),za[e].addEventListener("play",z),za[e].addEventListener("ended",j),za[e].addEventListener("error",U),_a?te.createMediaElementSource(za[e]).connect(_a):Ta.connectInput(za[e]);!function(){const e=(e,t,a,n,o)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),it(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return B().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,ho(n,a),wo(o))}))}))};e(lt("#enabled_modes"),"enabledMode",va,Bt,Ye),e(lt("#enabled_bgfit"),"enabledBgFit",Sa,mt,We);const t=lt("#enabled_gradients");Object.keys(ga).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${ga[e].disabled?"":"checked"}> ${ga[e].name}</label>`})),po();const a=lt("#random_properties");ka.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),it(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{ka.find((t=>t.value==e.value)).disabled=!e.checked,wo(Ve)}))})),it("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;lt(`.min-db[data-preset="${t}"]`).value=wa[t].min,lt(`.max-db[data-preset="${t}"]`).value=wa[t].max,lt(`.linear-boost[data-preset="${t}"]`).value=wa[t].boost,it(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==rn(aa)&&Oo(aa,!1),wo(at)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==rn(aa)&&Oo(aa,!1),wo(at)),e.classList.toggle("field-error",!t)}))}));for(const e of[Tt,ua,kt,oa,na])e.addEventListener("change",(()=>wo(Xe)));lt("#reset_osd").addEventListener("click",(()=>{Po(xa),wo(Xe)})),La.forEach((e=>{e.addEventListener("change",(()=>Oo(e)))})),lt("#reset_general").addEventListener("click",(()=>{Ao(Ea),Oo(La)}))}(),ho(Bt,va);for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])Vt[Vt.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])Yt[Yt.options.length]=new Option(e/1e3+"kHz",e);uo(bt,ya),uo(aa,[["0","Low"],["1","Normal"],["2","High"]]),uo(ft,[["1.5","Min"],["0.1","10"],["0.25","25"],["0.5","50"],["0.75","75"]]),ho(Gt,[["0","OFF"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),uo(Xt,[["0","Off"],["1","On"],["2","Full"]]),ho(ut,[[Z,"Album cover"],[J,"Black"],[X,"Gradient default"]]),ho(mt,Sa),uo(Ft,[["-1","Left"],["0","Off"],["1","Right"]]),uo(Lt,[[He,"Bark"],["linear","Lin"],[je,"Log"],["mel","Mel"]]),uo(ma,[["","OFF"],["A","A"],["B","B"],["C","C"],[Ue,"D"],["468","468"]]),uo(gt,[[ue,"Gradient"],[pe,"Index"],[fe,"Level"]]);const ae=fetch(G).then((e=>e.text())).then((e=>{const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp4|webm|mov)$/i;for(const{file:n}of I(e))t.test(n)?Ka.push(n):a.test(n)&&Wa.push(n);const n=Ka.length,o=Wa.length,s=Ka.map((e=>[Q+e,"🖼️ "+En(e).baseName])).concat(Wa.map((e=>[ee+e,"🎬 "+En(e).baseName]))).slice(0,20);o&&s.splice(0,0,[ee,"Random video"]),n&&s.splice(0,0,[Q,"Random image"]),jn("Found "+(n+o==0?"no media":n+" image files and "+o+" video")+" files in the backgrounds folder"),ho(ut,s,!0)})).catch((e=>{}));Mn(ht,.1,1,.1),Mn(It,1,3,.5),Mn(xt,0,.5,.1),Mn(ca,0,3,1),$o(),Object.keys(ga).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=ga[e];n&&Ta.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),fo(),Mo();const ne=new URL(document.location).searchParams.get("mode");let se="local"==ne||"server"!=ne&&await Qn(Je);null===se&&(se=!0);const le=function(e,t={}){let a;return g=document.createElement("ul"),g.className="breadcrumb",e.append(g),v=document.createElement("ul"),v.className="filelist",e.append(v),a=setTimeout((()=>{g.innerHTML="Waiting for server..."}),5e3),g.innerHTML="Initializing... please wait...",g.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=k.pop(),e--;const a=k[k.length-1];a&&a.handle&&(f=a.handle,t=null),$(t,t&&t.scrollTop)}(e.target.dataset.depth)})),v.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)$(t.handle||t.dataset.path);else if("request"==t.dataset.type)"granted"==await b[0].handle.requestPermission()&&(x=!1,M(b));else if("mount"==t.dataset.type)if(E)try{f=await window.showDirectoryPicker({startIn:"music"}),k=[],$(f)}catch(e){}else k=[],$(t.dataset.path)})),v.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&h&&["file","list"].includes(t.dataset.type)&&h({file:T(t.dataset.path),handle:t.handle},e)})),"function"==typeof t.onDblClick&&(h=t.onDblClick),"function"==typeof t.onEnterDir&&(m=t.onEnterDir),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async n=>{if(clearTimeout(a),n.startsWith("audioMotion")?(S=!0,y=1):y=p,1==y&&l){const e=await fetch("/getMounts");w=await e.json(),M(await async function(){const e=await fetch("/getHomeDir"),t=await e.text();let a=[];for(const e of t.split(i?"\\":"/"))a.push({dir:e,scrollTop:0});return a}())}else w=[t.rootPath||"/music"],L=await $(w[0]),(t.forceFileSystemAPI&&r||!L)&&(k=[],r?(w=[c],E=!0,b=t.lastDir,Array.isArray(b)&&b[0]&&(x=!0)):w=[],C());e({serverMode:y,useFileSystemAPI:E,hasServerMedia:L,filelist:v,serverSignature:y==p?"Standard web server":n})})).catch((t=>{clearTimeout(a),y=-1,r?(w=[c],E=!0):w=[],C(),e({serverMode:y,useFileSystemAPI:E,filelist:v})}))}))}(lt("#file_explorer"),{onDblClick:(e,t)=>{Rn([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{Qt.checked&&Y&&In(e)},forceFileSystemAPI:se,lastDir:await(0,_.U2)(et)}).then((e=>{qa=e.serverMode,Na=e.hasServerMedia,Ha=e.useFileSystemAPI;const{filelist:t,serverSignature:a}=e;qa!=Ne&&jn(`${a} detected at ${K}`),Na||jn(qa==Ne?"No server found":"Cannot access music directory on server",!0),Ha&&jn("Accessing files from local device via File System Access API."),H||jn("No browser support for File System Access API. Cannot access files from local device.",se),q||xo(Je,se&&H),no(),(q||Ha||Na)&&D.ZP.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{"playlist"==e.to.id&&(e.items.length?e.items:[e.item]).forEach((e=>{Fn({file:T(e.dataset.path),handle:e.handle}),e.remove()}))}}),_o()}));window.addEventListener("keydown",Xn),window.addEventListener("keyup",Xn),B().setOptions({positions:{alert:"bottom"}}),Promise.all([ae,le]).then((async()=>{jn(`Loading ${V?"last session":"default"} settings`),ao("last",!1,!0),Ha||M(await Qn(et)),jn(`AudioContext sample rate is ${te.sampleRate}Hz; Total latency is ${1e3*((te.outputLatency||0)+te.baseLatency)|0}ms`),jn("Initialization complete!"),Y=!0}))}()},7379:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,l=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,i=this.offsetLeft-t.offsetLeft<t.scrollLeft,r=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!l;(s||l)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(i||r)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||l||i||r)&&!e&&this.scrollIntoView(c)})},9283:()=>{},3838:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var l=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],i=!0,r=0;r<a.length;r++)(!1&s||l>=s)&&Object.keys(n.O).every((e=>n.O[e](a[r])))?a.splice(r--,1):(i=!1,s<l&&(l=s));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[l,i,r]=a,c=0;if(l.some((t=>0!==e[t]))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(r)var d=r(n)}for(t&&t(a);c<l.length;c++)s=l[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[216],(()=>n(2301)));o=n.O(o)})();
//# sourceMappingURL=audioMotion.js.map