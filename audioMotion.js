/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={6965:(e,t,a)=>{"use strict";var n=a(4015);const o=JSON.parse('{"rE":"24.3.0-beta.0"}'),s=location.origin+location.pathname,i="/music",l="electron"in window,r=l&&/Windows/.test(navigator.userAgent),c=!!window.showDirectoryPicker,d="Click to open a new root folder",u="No music found on server and no browser support for File System API",p=0;let f,h,m,b,g,v,y=[],k=/.*/,w=[],x=!1,L=!1,S=!1;function E(e,t){b.innerHTML="",g.innerHTML="",g.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.innerText=n,a.handle=e.handle,g.append(a)},n=e=>g.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==w.length&&(b.innerHTML=u),y.forEach((({dir:e},t)=>{b.innerHTML+=`<li data-depth="${y.length-t-1}">${e}</li> ${r?"\\":"/"==e?"":"/"} `})),w.forEach((e=>{g.innerHTML+=`<li data-type="mount" ${S&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),y.length>1&&(g.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),S&&t?t.handle.getFile().then((e=>{const t=URL.createObjectURL(e);n(t)})):n(t?C(t):"")}g.scrollTop=t||0}function $(e,t){let a,n,o=e&&"string"!=typeof e?e:null;if(o&&(e=o.name),e)if(".."==e){a=y.pop();const e=y[y.length-1];e&&e.handle&&(o=e.handle)}else y.push({dir:e,scrollTop:g.scrollTop,handle:o});return g.innerHTML="<li>Loading...</li>",n=C(),new Promise((async e=>{const s=n=>{!1!==n&&(x&&!S||(n=O(n)),E(n,t||a&&a.scrollTop),m&&m(y),e(!0)),e(!1)};if(f){o&&(f=o);let e=[];for await(const t of f.entries())e.push(t);s(e)}else fetch(n).then((e=>200==e.status&&(x?e.json():e.text()))).then((e=>s(e))).catch((()=>e(!1)))}))}function C(e,t){let a="";return y.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=a.replace(/#/g,"%23"),l?(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)):v==p&&(a=s+a),a}function A(e="li"){let t=[];return g.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:C(e.dataset.path),handle:e.handle,type:e.dataset.type})})),t}async function T(e){const t=[...y],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();".."==e?(t.pop(),n=t[t.length-1].handle):(n=await n.getDirectoryHandle(e),t.push({handle:n}))}return await n.getFileHandle(a.shift())}function P(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,n]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i);a.push({uri:t,file:n})}return a}function O(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i;let a=[],n=[],o=[];const s=(e,a)=>{const n=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(S)for(const[s,i]of e)i instanceof FileSystemDirectoryHandle?n.push({name:s,handle:i}):i instanceof FileSystemFileHandle&&(s.match(t)&&o.push({name:s,handle:i}),s.match(k)&&a.push({name:s,handle:i}));else for(const{uri:s,file:i}of P(e))"/"==s.substring(s.length-1)?i.match(/(parent directory|\.\.)/i)||("/"==i.substring(i.length-1)?n.push(i.substring(0,i.length-1)):n.push(i)):(i.match(t)&&o.push(i),i.match(k)&&a.push(i));const i=(e,t)=>{const a="object"==typeof e;return(new Intl.Collator).compare(...a?[e.name,t.name]:[e,t])};return{cover:s(o,"cover")||s(o,"folder")||s(o,"front")||o[0],dirs:n.sort(i),files:a.sort(i)}}function I(){$(null,g.scrollTop)}function M(e){k=new RegExp("\\.("+e.join("|")+")$","i")}async function R(e){if(!e)return!1;const t=[...y],a=e[e.length-1];y=e,a&&a.handle&&(f=a.handle);const n=await $();return n||(y=t),n}var _=a(6015),D=(a(6216),a(7783)),F=a(246),q=a(4596),B=a.n(q);F.Ay.mount(new F.cR);const N="electron"in window,H=N&&/Windows/.test(navigator.userAgent),j="/getFile/",U="/getCover/",z="/savePlist/",W=location.origin+location.pathname,K=o.rE,G=N?"/getBackground":"backgrounds",J=4,V=1e3,X="0",Y="1",Z="2",Q="3",ee="4",te="0",ae="1",ne="2",oe="0",se="1",ie="2",le="3",re="6",ce="7",de="8",ue={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},pe="dual-combined",fe="single",he="gradient",me="bar-index",be="bar-level",ge=20,ve=["jpg","jpeg","webp","avif","png","gif","bmp"],ye=["mp3","flac","m4a","aac","ogg","wav"],ke=["m3u","m3u8"],we=["mkv","mpg","webm","mp4","avi","mov"],xe="local",Le="bgDir",Se="custom-grads",Ee="custom-preset",$e="disabled-bgfit",Ce="disabled-gradients",Ae="disabled-modes",Te="disabled-properties",Pe="display-options",Oe="force-filesystem",Ie="general-settings",Me="last-config",Re="last-dir",_e="playlists",De="playqueue",Fe="sensitivity-presets",qe="pl_",Be="10",Ne="101",He="1",je="2",Ue="alpha",ze="nobg",We="barSp",Ke="imgfit",Ge="stereo",Je="colormode",Ve="fill",Xe="gradient",Ye="leds",Ze="line",Qe="lumi",et="mirror",tt="mode",at="outline",nt="peaks",ot="presets",st="radial",it="spin",lt="reflex",rt="round",ct="split",dt="bark",ut="log",pt=1,ft=-1,ht="config.json",mt={defaultAccessMode:xe,enableLocalAccess:!0},bt="D",gt="No description",vt=document.querySelector.bind(document),yt=document.querySelectorAll.bind(document),kt=vt("#alpha_bars"),wt=vt("#analyzer"),xt=vt("#ansi_bands"),Lt=vt("#background"),St=vt("#balance"),Et=vt("#bar_space"),$t=vt("#bg_img_dim"),Ct=vt("#bg_img_fit"),At=vt("#bg_location"),Tt=vt("#bg_max_items"),Pt=vt("#channel_layout"),Ot=vt("#color_mode"),It=vt("#bg_container"),Mt=vt("#bg_dim"),Rt=vt("#enable_video"),_t=vt("#end_timeout"),Dt=vt("#fft_size"),Ft=vt("#fill_alpha"),qt=vt("#fps"),Bt=vt("#freq_scale"),Nt=vt("#fs_height"),Ht=vt("#gradient"),jt=vt("#gradientRight"),Ut=vt("#info_timeout"),zt=vt("#led_display"),Wt=vt("#linear_amplitude"),Kt=vt("#line_width"),Gt=vt("#link_grads"),Jt=vt("#loaded_playlist"),Vt=vt("#lo_res"),Xt=vt("#lumi_bars"),Yt=vt("#max_fps"),Zt=vt("#mirror"),Qt=vt("#mode"),ea=vt("#mute"),ta=vt("#no_shadow"),aa=vt("#note_labels"),na=vt("#outline"),oa=vt("#osd"),sa=vt("#pip_ratio"),ia=vt("#playlists"),la=vt("#radial"),ra=vt("#random_mode"),ca=vt("#freq_max"),da=vt("#freq_min"),ua=vt("#reflex"),pa=vt("#repeat"),fa=vt("#round_bars"),ha=vt("#save_dir"),ma=vt("#save_queue"),ba=vt("#scaleX"),ga=vt("#scaleY"),va=vt("#sensitivity"),ya=vt("#show_count"),ka=vt("#show_cover"),wa=vt("#show_peaks"),xa=vt("#show_song"),La=vt("#smoothing"),Sa=vt("#source"),Ea=vt("#spin"),$a=vt("#split_grad"),Ca=vt("#track_timeout"),Aa=vt("#video"),Ta=vt("#volume"),Pa=vt("#warp"),Oa=vt("#weighting"),Ia=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:oe,channelLayout:fe,colorMode:he,freqMax:2e4,freqMin:25,freqScale:ut,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",noteLabels:1,outlineBars:0,radial:0,randomMode:0,reflex:He,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:se,channelLayout:fe,colorMode:he,freqMax:2e4,freqMin:25,freqScale:ut,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",noteLabels:0,radial:0,randomMode:0,reflex:"0",roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:Z,bgImageDim:.3,bgImageFit:se,channelLayout:pe,colorMode:he,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:dt,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:Ne,noteLabels:0,radial:0,randomMode:0,reflex:"0",showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:Z,barSpace:.1,bgImageDim:.3,bgImageFit:le,channelLayout:fe,colorMode:be,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",noteLabels:0,outlineBars:0,radial:1,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:1,splitGrad:0,weighting:bt}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:ce,channelLayout:fe,colorMode:me,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:je,roundBars:1,showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:bt}},{key:"last",name:"Last session",options:{}},{key:"default",name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:X,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:se,channelLayout:fe,colorMode:he,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:ut,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,mirror:0,mode:"0",noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:"0",repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""}}],Ma={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},Ra=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:Be,text:"Area graph",disabled:!1},{value:Ne,text:"Line graph",disabled:!1},{value:"8",text:"Octave bands / 10 bands",disabled:!1},{value:"7",text:"1/2 octave / 20 bands",disabled:!1},{value:"6",text:"1/3 octave / 30 bands",disabled:!1},{value:"5",text:"1/4 octave / 40 bands",disabled:!1},{value:"4",text:"1/6 octave / 60 bands",disabled:!1},{value:"3",text:"1/8 octave / 80 bands",disabled:!1},{value:"2",text:"1/12 octave / 120 bands",disabled:!1},{value:"1",text:"1/24 octave / 240 bands",disabled:!1}],_a=[[fe,"Singl"],[pe,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],Da=[{value:Ue,text:"Alpha",disabled:!1},{value:tt,text:"Analyzer Mode",disabled:!1},{value:ze,text:"Background",disabled:!1},{value:We,text:"Bar Spacing",disabled:!1},{value:Ke,text:"BG Image Fit",disabled:!1},{value:Ge,text:"Channel Layout",disabled:!1},{value:Je,text:"Color Mode",disabled:!1},{value:Ve,text:"Fill Opacity",disabled:!1},{value:Xe,text:"Gradients",disabled:!1},{value:Ye,text:"LEDs",disabled:!1},{value:Ze,text:"Line Width",disabled:!1},{value:Qe,text:"Lumi",disabled:!1},{value:et,text:"Mirror",disabled:!1},{value:at,text:"Outline",disabled:!1},{value:nt,text:"Peaks",disabled:!1},{value:st,text:"Radial",disabled:!1},{value:it,text:"Radial Spin",disabled:!1},{value:lt,text:"Reflex",disabled:!1},{value:rt,text:"Round",disabled:!1},{value:ct,text:"Split",disabled:!1},{value:ot,text:"User Presets",disabled:!0}],Fa=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],qa={info:5,track:10,end:10,covers:!0,count:!0},Ba=[{value:oe,text:"Adjust",disabled:!1},{value:se,text:"Center",disabled:!1},{value:le,text:"Pulse",disabled:!1},{value:ie,text:"Repeat",disabled:!1},{value:re,text:"Warp",disabled:!1},{value:ce,text:"Warp Drive",disabled:!1},{value:de,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],Na=[At,Tt,Rt,Dt,Nt,Yt,sa,ha,ma,La],Ha={bgLocation:ae,bgMaxItems:20,enableVideo:!1,fftSize:8192,fsHeight:100,maxFPS:60,pipRatio:2.35,saveDir:!0,saveQueue:!0,smoothing:.7},ja=[[30,"30"],[60,"60"],[0,"unlimited"]],Ua=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let za,Wa,Ka,Ga,Ja,Va,Xa,Ya,Za,Qa,en,tn,an,nn,on,sn,ln,rn=[],cn=[],dn=[],un=null,pn={},fn=!1,hn=!1,mn=!1,bn=0;const gn=oa.getContext("2d"),vn=new Image,yn=document.createElement("video"),kn=(e,t)=>e.replace(/(%2f|\/)/g,t&&H?"\\":"/"),wn=e=>e.replace(/\//g,"%2f"),xn=e=>Math.round(100*e)/100,Ln=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},Sn=e=>{let t="";if(Mn(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},En=e=>Mn(e)?e.elements[e.dataset.prop].value:void 0!==e.dataset.active?e.dataset.active:e.value,$n=e=>({alphaBars:En(kt),ansiBands:En(xt),background:En(Lt),barSpace:En(Et),bgImageDim:En($t),bgImageFit:En(Ct),channelLayout:En(Pt),colorMode:En(Ot),fillAlpha:En(Ft),freqMax:En(ca),freqMin:En(da),freqScale:En(Bt),gradient:En(Ht),gradientRight:En(jt),ledDisplay:En(zt),linearAmpl:En(Wt),lineWidth:En(Kt),linkGrads:En(Gt),loRes:En(Vt),lumiBars:En(Xt),mirror:En(Zt),mode:En(Qt),noShadow:En(ta),noteLabels:En(aa),outlineBars:En(na),radial:En(la),randomMode:En(ra),reflex:En(ua),repeat:En(pa),roundBars:En(fa),sensitivity:En(va),showFPS:En(qt),showPeaks:En(wa),showScaleX:En(ba),showScaleY:En(ga),showSong:En(xa),spin:En(Ea),splitGrad:En($a),weighting:En(Oa)}),Cn=e=>{const t=+e==e?e:Ia.findIndex((t=>t.key==e));return t<0||t>Ia.length-1?-1:t},An=e=>{const t=Cn(e);return-1==t?{}:Ia[t].options},Tn=e=>{const t=Cn(e);return-1!=t&&Ia[t].name},Pn=()=>{const e=En(Pt)!=fe&&!qn(Gt);return`Gradient${e?"s":""}: ${Ma[Ht.value].name+(e?" / "+Ma[jt.value].name:"")}`},On=()=>sn.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${_n(e)?'<em class="empty">Empty slot</em>':e.name||gt}`)),In=e=>e.startsWith("blob:"),Mn=e=>"FORM"==e.tagName&&null!=e.dataset.prop,Rn=e=>e.startsWith("http")&&!e.startsWith(W),_n=e=>!e||"object"!=typeof e||!Object.keys(e).length,Dn=e=>It.classList.contains("pip"),Fn=(e=rn[Ka])=>e&&e.currentTime>0&&!e.paused&&!e.ended,qn=e=>"1"==e.dataset.active,Bn=e=>"string"==typeof e?e.replace(/\\/g,"/"):e,Nn=e=>qn(e)?"ON":"OFF",Hn=e=>{const t=Kn(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),i=s>=0?o.slice(0,s):o,l=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:i,extension:l}},jn=e=>{e=e.replace(/_/g," ");const[,,t,a,,n,o]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{artist:n,title:o,duration:","==a?Jn(t):""}},Un=e=>(N&&!Rn(e)&&(e.startsWith(j)&&(e=e.slice(9)),e=j+wn(e)),e),zn=e=>Qa.children.length,Wn=(e=2)=>Math.random()*e|0,Kn=e=>{const t=new RegExp(`^${j}`);return Bn(kn(e.replace(t,"")))},Gn=e=>{on?(0,D.hZ)(Re,e):an!=ft&&Ho(Re,e)},Jn=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},Vn=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n};function Xn(e,t=!1){const a=e.map((e=>Qn(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${zn()<V?"":". Queue is full!"}`;B().alert({text:a,time:5}),os(!0)}))}function Yn(e,t){const a=t.dataset,n=e.dataset,o=e.common,s=e.format;if(n)Object.assign(a,n);else if(a.artist=o.artist||a.artist,a.title=o.title||a.title,a.album=o.album?o.album+(o.year?" ("+o.year+")":""):"",a.codec=s?s.codec||s.container:a.codec,s&&(s.bitsPerSample||s.sampleRate&&!s.bitrate)?a.quality=(s.sampleRate?(s.sampleRate/1e3|0)+"KHz":"")+(s.sampleRate&&s.bitsPerSample?" / ":"")+(s.bitsPerSample?s.bitsPerSample+"bits":""):s&&s.bitrate?a.quality=(s.bitrate/1e3|0)+"K "+(s.codecProfile||""):a.quality="",s&&s.duration?a.duration=Jn(s.duration):a.duration="",o.picture&&o.picture.length){const e=new Blob([o.picture[0].data],{type:o.picture[0].format});a.cover=URL.createObjectURL(e)}t==rn[Ka]&&Go()}function Zn(e,t={},a){return new Promise((n=>{zn()>=V&&n(0);let o=Bn(e.file);const s=kn(o).split("/").pop(),i=s.split(".").pop(),l=document.createElement("li"),r=l.dataset;Object.assign(r,ue),r.artist=t.artist||"",r.title=t.title||s.replace(/%23/g,"#")||o.slice(o.lastIndexOf("//")+2),r.duration=t.duration||"",r.codec=i!==s?i.toUpperCase():"",l.handle=e.handle,o=o.replace(/#/g,"%23"),r.file=o,Qa.appendChild(l),we.includes(i)||(r.retrieve=1,Do()),!a&&1!=zn()||Fn()?n(1):wo(0,a).then((()=>n(1))),en>zn()-3&&go()}))}function Qn(e,t=!1){let a;return a=ke.includes(Hn(e.file).extension)?vo(e,t):Zn(e,jn(Hn(e.file).baseName),t),a.then((e=>{t&&!Fn()&&e>0&&$o(zn()-e)})),a}function eo(e){let t=e?xn((+St.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),Wo(t),Ko("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),cs()}function to(e){const t=+Nt.value;(1==e&&t<+Nt.max||-1==e&&t>+Nt.min)&&(Nt.value=t+Nt.step*e,Yo(Nt)),Ko(`Analyzer height: ${Nt.value}%`)}function ao(e){let t=xn((+Ta.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),Qo(t),Ko("Volume: "+20*t),cs()}function no(e=Ka){const t=rn[e],a=t.dataset;ho(t,null),Object.assign(a,ue),t.load(),e==Ka&&Go()}function oo(e,t,a){const n=vt("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML=""),t&&vt("#toggle_console").classList.add("warning"),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function so(e,t){const a=Mn(e)?e.elements[e.dataset.prop]:e.options;let n=(Mn(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),Mn(e)?a[n].checked=!0:e.selectedIndex=n,Yo(e)}function io(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function lo(){un&&un.key&&(delete Ma[un.key],0===Object.keys(Ma).filter((e=>!Ma[e].disabled)).length&&(Ma[Object.keys(Ma)[0]].disabled=!1),Po(),To(),No(Se),No(Ce),un=null,location.href="/#config")}function ro(e,t){if(_n(sn[e]))return;const a=`User Preset #${e+1}`,n=sn[e].name?"<br>"+sn[e].name:"";t?(sn[e]={},Ho(Ee,sn),B().alert({text:`Deleted ${a}`})):B().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{ro(e,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}})}function co(e=1){const t=rn[Ka];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),Ko(1),t.currentTime=a}"m"==fn&&Uo("m",e)}function uo(){return clearTimeout(Ga),!!fn&&(fn=!1,!0)}async function po(){Dn()&&await document.exitPictureInPicture(),za.toggleFullscreen(),document.activeElement.blur()}function fo(e){if("F1"==e.code&&!e.altKey&&!e.ctrlKey)return location.href="#help",void e.preventDefault();if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?to(1):ao(1);break;case"ArrowDown":t?to(-1):ao(-1);break;case"ArrowLeft":t?eo(-1):fn?(Ko("Rewind",1),co(-1)):Uo("k",-1);break;case"ArrowRight":t?eo(1):fn?(Ko("Fast forward",1),co()):Uo("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(Io(!0),Yo(ra,!1));else if(t){const e=$n();e.randomMode=0,jo(a,e)}else yo(a)}else switch(e.code){case"Delete":case"Backspace":Qa.querySelectorAll(".selected").forEach((e=>{Fo(e),e.remove()}));const e=Ln(Qa.querySelector(".current"));void 0!==e?en=e:en>zn()-1?en=zn()-1:en--,zn()?go():(no(Ya),Fn()||no());break;case"Space":Ko(Fn()?"Pause":"Play",1),So();break;case"ArrowLeft":case"KeyJ":uo()||t||(Ko("Previous track",1),as(!0));break;case"KeyG":so(Ht,t),Ko(Pn());break;case"ArrowRight":case"KeyK":uo()||t||(Ko("Next track",1),as());break;case"KeyA":so(ra,t),Ko("Randomize: "+Sn(ra)),Yo(ra);break;case"KeyB":so(t?Ct:Lt);const a=Lt.value[0];Ko("Background: "+Sn(Lt)+(a>1&&a<7?` (${Sn(Ct)})`:""));break;case"KeyC":la.click(),Ko("Radial "+Nn(la));break;case"KeyD":is();break;case"KeyE":zn()>0&&(ts(),Ko("Shuffle"));break;case"KeyF":po();break;case"KeyH":qt.click();break;case"KeyI":xa.click(),Ko("Song info display "+Nn(xa));break;case"KeyL":zt.click(),Ko("LED effect "+Nn(zt));break;case"KeyM":case"KeyV":so(Qt,t),Ko("Mode: "+Sn(Qt));break;case"KeyN":so(va,t),Ko(Sn(va).toUpperCase()+" sensitivity");break;case"KeyO":Vt.click(),Ko((qn(Vt)?"LOW":"HIGH")+" Resolution");break;case"KeyP":wa.click(),Ko("Peaks "+Nn(wa));break;case"KeyR":pa.click(),Ko("Queue repeat "+Nn(pa));break;case"KeyS":Ko("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+ba.dataset.active+(ga.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),ba.dataset.active=1&t,ga.dataset.active=t>>1,Yo([ba,ga]),t}(t)]);break;case"KeyT":ta.click(),Ko((qn(ta)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Xt.click(),Ko("Luminance bars "+Nn(Xt));break;case"KeyX":so(ua,t),Ko("Reflex: "+Sn(ua));break;default:return}e.preventDefault()}function ho(e,t){const a=e.src||"";In(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src")}function mo(e,t,a){return new Promise((n=>{ho(t,URL.createObjectURL(e)),t.onloadeddata=()=>{a&&t.play(),n(!0)}}))}async function bo(e){return JSON.parse(N?await electron.api("storage-get",e):localStorage.getItem(e))}async function go(){const e=en<zn()-1?en+1:0,t=Qa.children[e],a=rn[Ya];t&&(Yn(t,a),t.handle?(await t.handle.requestPermission(),t.handle.getFile().then((e=>mo(e,a))).then((()=>a.load()))):(ho(a,t.dataset.file),a.load())),mn=!1}function vo(e,t=!1){let a=Bn(e.file);return new Promise((async n=>{let o=[];const s=()=>{Promise.all(o).then((e=>{const t=e.reduce(((e,t)=>e+t),0);n(t)}))},i=async e=>{let n;Jt.dataset.path||Xo(a),a=Hn(a).path;for(let s of e.split(/[\r\n]+/))if("#"!=s.charAt(0)&&""!=s.trim()){let e;s=Bn(s),n||(n=Hn(s).baseName),Rn(s)||(on&&(e=await T(s),e||oo(`Cannot resolve file handle for ${s}`,!0)),":"!=s[1]&&"/"!=s[0]&&(s=a+s)),o.push(Zn({file:Un(s),handle:e},jn(n),t)),t=!1,n=""}else s.startsWith("#EXTINF")&&(n=s.slice(8));s()};if(a)if("string"==typeof a&&ke.includes(Hn(a).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(i).catch((e=>{oo(e,!0),n(0)})):fetch(a).then((e=>{if(200==e.status)return e.text();oo(`Fetch returned error code ${e.status} for URI ${a}`,!0)})).then(i).catch((e=>{oo(e,!0),n(0)}));else{const e=await(0,D.Jt)(!0===a?De:qe+a);Array.isArray(e)?(e.forEach((e=>{const t=Bn(e.file),a=e.handle;o.push(Zn({file:t,handle:a},jn(Hn(t).baseName)))})),s()):(!0!==a&&oo(`Unrecognized playlist file: ${a}`,!0),n(0))}else n(-1)}))}function yo(e,t=!0,a,n){const o=+e==e,s=o?sn[e].options:An(e),i=An("default");_n(s)||(t&&oo("Loading "+(o?"User Preset #"+(e+1):"'"+Tn(e)+"' preset")),void 0!==s.stereo&&(s.channelLayout=_a[+s.stereo][0]),yt("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==s[t]?s[t]:a?i[t]:void 0;if(void 0!==o&&(e!=ra||!n))if(Mn(e)){const t=e.querySelector(`[value="${o}"]`);t&&(t.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+o:e==Ta?Qo(o):e==St?Wo(o):(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),ds(e))})),za.setOptions({alphaBars:qn(kt),ansiBands:qn(xt),colorMode:En(Ot),fftSize:En(Dt),frequencyScale:En(Bt),ledBars:qn(zt),linearAmplitude:qn(Wt),loRes:qn(Vt),lumiBars:qn(Xt),maxFPS:En(Yt),maxFreq:En(ca),minFreq:En(da),mirror:En(Zt),noteLabels:qn(aa),outlineBars:qn(na),radial:qn(la),roundBars:qn(fa),showFPS:qn(qt),showPeaks:qn(wa),showScaleX:qn(ba),showScaleY:qn(ga),smoothing:En(La),spinSpeed:En(Ea),splitGradient:qn($a),weightingFilter:En(Oa)}),Yo([Lt,Ct,$t,Pt,Nt,Gt,va,ua,Ht,jt,...n?[]:[ra],Et,Qt]),"demo"==e&&Io(!0),t&&B().alert({text:"Settings loaded!"}))}async function ko(e){io(ia);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,ia.options[ia.options.length]=t;let a=await(0,D.Jt)(_e);const n=await bo(_e);if(n){for(const e of Object.keys(n)){const t=qe+e,o=await bo(t);let s=[];for(const e of o)s.push({file:e});await(0,D.hZ)(t,s),Mo(t),a[e]=n[e]}await(0,D.hZ)(_e,a),Mo(_e)}if(a)for(const t of Object.keys(a)){const n=new Option(a[t],t);n.dataset.isLocal="1",t==e&&(n.selected=!0),ia.options[ia.options.length]=n}fetch("playlists.cfg").then((e=>200==e.status&&(oo("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(ia.options[ia.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?oo(`${t} playlists loaded from playlists.cfg`):oo("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function wo(e,t){return new Promise((async a=>{const n=rn[Ka],o=()=>{ls(),go(),a(!0)};if(Qa.children[e]){en=e;const a=Qa.children[en];Yn(a,n),a.handle?(await a.handle.requestPermission(),a.handle.getFile().then((e=>mo(e,n,t))).then((()=>o()))):(ho(n,a.dataset.file),n.onloadeddata=()=>{t&&n.play(),o()})}else a(!1)}))}function xo(){un={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(Ma).some((e=>e===un.key))&&e<10;)un.key=`custom-gradient-${e}`,e++;Ro(),vt("#btn-save-gradient").innerText="Add",vt("#btn-delete-gradient").style.display="none",location.href="/#gradient-editor"}function Lo(e){if(mn||Va||en>zn()-1)return!0;if(mn=!0,en<zn()-1)en++;else{if(!qn(pa))return mn=!1,!1;en=0}return e|=Fn(),Ka=Ya,Ya=0|!Ka,Go(),e?rn[Ka].play().then((()=>go())).catch((e=>{e.code!=ge&&(oo(e,!0),go(),Lo(!0))})):go(),ls(),!0}function So(e){Va||(Fn()&&!e?(rn[Ka].pause(),Dn()&&yn.pause()):rn[Ka].play().catch((e=>{e.code!=ge&&(oo(e,!0),Lo(!0))})))}function Eo(){let e=!0;return Fn()?rn[Ka].currentTime>2?rn[Ka].currentTime=0:en>0?$o(en-1):e=!1:e=wo(en-1),e}function $o(e){wo(e,!0)}function Co(){let e=[{value:Z,text:"Album cover"},{value:Y,text:"Black"},{value:X,text:"Gradient default"}];const t=e.length,a=cn.length,n=dn.length;e=[...e,...cn.map(((e,t)=>({value:Q+e.name,text:"🖼️ "+e.name,idx:t}))),...dn.map(((e,t)=>({value:ee+e.name,text:"🎬 "+e.name,idx:t})))].slice(0,t+ +Tt.value),n&&e.splice(t,0,{value:ee,text:"Random video"}),a&&e.splice(t,0,{value:Q,text:"Random image"}),Oo(Lt,e)}function Ao(e,t){const a=!Array.isArray(t[0]);for(const n of a?t.filter((e=>!e.disabled)):t){const t=e.dataset.prop,a=n.text||n[1],o=n.value||n[0],s=t+"-"+o,i=document.createElement("input"),l=document.createElement("label");i.name=t,i.id=s,i.type="radio",i.value=o,l.htmlFor=s,l.innerText=a,e.append(i,l)}}function To(){const e=vt("#enabled_gradients");io(e),Object.keys(Ma).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ma[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${Ma[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ma[t].disabled?"":"checked"}>\n                   ${Ma[t].name}\n                </label>`})),yt(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(Ma).reduce(((e,t)=>e+!Ma[t].disabled),0)<2)return B().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;Ma[e.dataset.grad].disabled=!e.checked,Po(),No(Ce)}))})),yt(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!Ma[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=Ma[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});un=a}(e.target.getAttribute("data-grad")),Ro(),vt("#btn-save-gradient").innerText="Save",vt("#btn-delete-gradient").style.display="block",location.href="/#gradient-editor"}))}))}function Po(){for(const e of[Ht,jt]){let t=e.value;io(e);for(const t of Object.keys(Ma))Ma[t].disabled||(e.options[e.options.length]=new Option(Ma[t].name,t));""!==t&&(e.value=t,Yo(e))}}function Oo(e,t){const a=e.value;Array.isArray(t)||(t=[t]),io(e);for(const a of t.filter((e=>e&&!e.disabled))){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),void 0!==a.idx&&(t.idx=a.idx),e[e.options.length]=t}""!==a&&(e.value=a,-1==e.selectedIndex&&(e.selectedIndex=0),Yo(e))}function Io(e=Va){if(!Fn()&&!e)return;const t=e=>!Da.find((t=>t.value==e)).disabled,a=(e,t=!0,a=(()=>!0))=>{let o=9;do{if(Mn(e)){const t=e.elements[e.dataset.prop];t[Wn(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=Wn();else if(e.step){const{min:t,max:a,step:n}=e,o=Wn((a-t)/n+1)*n+ +t;e.value=(10*o|0)/10,ds(e)}else e.selectedIndex=Wn(e.options.length)}while(!a(En(e))&&o--);t&&n.push(e)};let n=[];if(t(ot)){const e=sn.map(((e,t)=>_n(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&yo(e[Wn(t)],!1,!1,!0)}if(t(tt)&&a(Qt),t(Ue)&&a(kt),t(ze)&&a(Lt,!1),t(Ke)&&a(Ct),t(Ge)&&a(Pt,!0,(e=>e!=pe)),t(Je)&&a(Ot),t(nt)&&a(wa),t(Ye)&&a(zt),t(Qe)&&a(Xt,!0,(e=>!e||Lt.value[0]<=1||!qn(zt))),t(Ze)&&a(Kt,!1),t(Ve)&&a(Ft,!1),t(We)&&a(Et,!1),t(at)&&a(na),t(lt)&&a(ua,!1,(e=>e!=je||!qn(zt))),t(st)&&a(la),t(rt)&&a(fa),t(it)&&a(Ea),t(ct)&&a($a),t(et)&&a(Zt),t(Xe))for(const e of[Ht,...qn(Gt)?[]:[jt]])a(e);n.push(Lt,ua,Qt),Yo(n)}function Mo(e){N?electron.api("storage-remove",e):localStorage.removeItem(e)}function Ro(){if(null==un)throw new Error("Current gradient must be set before editing gradient");const e=vt("#grad-color-table");io(e),vt("#new-gradient-name").value=un.name,vt("#new-gradient-horizontal").checked="h"===un.dir;const t=vt("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),un.colorStops.forEach(((e,t)=>{!function(e,t){const a=vt("#grad-color-table"),n=vt("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),i=n.querySelector(".grad-color-stop"),l=n.querySelector(".grad-add-stop"),r=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,i.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,un.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,un.colorStops[e].color=o.value})),i.addEventListener("input",(t=>{un.colorStops[e].pos=parseFloat(t.target.value)})),l.addEventListener("click",(()=>{un.colorStops.splice(e+1,0,{pos:(()=>{if(e===un.colorStops.length-1){const e=un.colorStops[un.colorStops.length-1].pos;return un.colorStops[un.colorStops.length-1].pos=(un.colorStops[un.colorStops.length-2].pos+e)/2,e}return(un.colorStops[e].pos+un.colorStops[e+1].pos)/2})(),color:"#111111"}),Ro()})),2===un.colorStops.length?r.setAttribute("disabled","true"):r.addEventListener("click",(()=>{un.colorStops.splice(e,1),Ro()})),n.removeAttribute("id"),a.appendChild(n)}(t,un.colorStops[t])})),vt("#new-gradient-bkgd").value=un.bgColor}async function _o(){const e=At.value,t=new RegExp("\\.("+ve.join("|")+")$","i"),a=new RegExp("\\.("+we.join("|")+")$","i");if(cn=[],dn=[],e==ae)try{const e=await fetch(G),n=await e.text();for(const{file:e}of P(n)){const n=Hn(e).baseName,o=G+"/"+encodeURIComponent(e);t.test(e)?cn.push({name:n,url:o}):a.test(e)&&dn.push({name:n,url:o})}}catch(e){}else if(e==ne){const e=await(0,D.Jt)(Le);try{if(e)for await(const[n,o]of e.entries())if(o instanceof FileSystemFileHandle){const e=t.test(n),s=a.test(n);if(e||s){const t=await o.getFile(),a=URL.createObjectURL(t);e?cn.push({name:n,url:a}):dn.push({name:n,url:a})}}}catch(e){}}if(e!=te){const e=cn.length,t=dn.length;oo("Found "+(e+t==0?"no media":e+" image files and "+t+" video")+" files in the backgrounds folder")}Co()}async function Do(){if(bn>=J)return;const e=Array.from(Qa.children).find((e=>e.dataset.retrieve));if(e){let t=e.dataset.file,a=!1;bn++,delete e.dataset.retrieve;e:{if(e.handle){if("granted"!=await e.handle.requestPermission())break e;t=URL.createObjectURL(await e.handle.getFile()),a=!0}try{const a=await _.WC(t,{skipPostHeaders:!0});a&&(Yn(a,e),ss(e),e.handle||a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=Hn(e).path;if(an==ft||Rn(e))t("");else if(void 0!==pn[a])t(Un(a+pn[a]));else{const e=an==pt?U+wn(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let n="";if(e)if(an==pt)n=e;else{const t=O(e);t.cover&&(n=t.cover)}pn[a]=n,t(Un(a+n))}))}}))}(t).then((t=>{e.dataset.cover=t,ss(e)})))}catch(e){}a&&URL.revokeObjectURL(t)}bn--,Do()}}function Fo(e){const t=e.dataset.cover;In(t)&&URL.revokeObjectURL(t)}function qo(){null!==un&&(Ma[un.key]=un,za.registerGradient(un.key,un),Po(),To(),No(Se),un=null,location.href="/#config")}function Bo(e,t){if(0==zn())return void B().alert({text:"Queue is empty!"});if(!e)return void B().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?Bo(C(e,!0)):B().alert({text:"Canceled"})},cancelCallback:()=>{B().alert({text:"Canceled"})}});const a=[];Qa.childNodes.forEach((e=>{const{file:t,artist:n,title:o,duration:s}=e.dataset;a.push({file:Kn(t),artist:n,title:o,duration:s})})),fetch(z+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const n=e?`${t?"Updated":"Saved as"} ${Hn(e).fileName}`:a;B().alert({text:n}),Xo(e),I()}))}function No(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Ae||Ho(Ae,t(Ra)),e&&e!=$e||Ho($e,t(Ba)),e&&e!=Ce||Ho(Ce,Object.keys(Ma).map((e=>({value:e,disabled:Ma[e].disabled})))),!e||e==Se){const e={};Object.keys(Ma).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=Ma[t])),Ho(Se,e)}if(e&&e!=Te||Ho(Te,t(Da)),!e||e==Fe){let e=[];for(const t of[0,1,2])e.push({min:vt(`.min-db[data-preset="${t}"]`).value,max:vt(`.max-db[data-preset="${t}"]`).value,boost:vt(`.linear-boost[data-preset="${t}"]`).value});Ho(Fe,e)}if(!e||e==Pe){const e={info:Ut.value,track:Ca.value,end:_t.value,covers:ka.checked,count:ya.checked};Ho(Pe,e)}if(!e||e==Ie){const e={bgLocation:At.value,bgMaxItems:Tt.value,enableVideo:Rt.checked,fftSize:Dt.value,fsHeight:Nt.value,maxFPS:Yt.value,pipRatio:sa.value,saveDir:ha.checked,saveQueue:ma.checked,smoothing:La.value};Ho(Ie,e)}}function Ho(e,t){const a=JSON.stringify(t);N?electron.api("storage-set",e,a):localStorage.setItem(e,a)}function jo(e,t,a,n){const o=`User Preset #${e+1}`,s=sn[e].name||"",i=za.isFullscreen;if(!_n(sn[e])&&!n&&hn!==e)return void(i?(Ko(`Overwrite ${o} - Press again to confirm!`,5),hn=e,setTimeout((()=>{hn===e&&(hn=!1)}),5e3)):B().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{jo(e,t,a,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}}));if(hn=!1,!a||!`${a}`.trim()){if(!i)return void B().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{jo(e,t,a.trim()||gt,!0)},cancelCallback:()=>{B().alert({text:"Save canceled!"})}});a=""}a==gt&&(a=""),sn[e]={name:a,options:t},Ho(Ee,sn);const l=`Saved to ${o}`;i?Ko(l,5):B().alert({text:l})}function Uo(e,t=1){Ga=setTimeout((()=>{fn=e,co(t)}),200)}function zo(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function Wo(e){St.dataset.value=e,Za&&(Za.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),St.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function Ko(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(Wa.info=e,Wa.startTime=n,Wa.endTime=Math.max(o,Wa.endTime||0),Wa.fade=t==1/0?0:t/3*a):(Wa.msg=e,2==Wa.info&&(Wa.info=1),Wa.msgTimer=o)}else Wa={endTime:0,msgTimer:0}}function Go(){vn.src=rn[Ka].dataset.cover,Lt.value==Z&&zo(vn.src)}function Jo(e){At.value=e.bgLocation,Tt.value=e.bgMaxItems,Rt.checked=e.enableVideo,Dt.value=e.fftSize,Nt.value=e.fsHeight,Yt.value=e.maxFPS,sa.value=e.pipRatio,ha.checked=e.saveDir,ma.checked=e.saveQueue,La.value=e.smoothing}function Vo(e){Ut.value=e.info,Ca.value=e.track,_t.value=e.end,ka.checked=e.covers,ya.checked=e.count}function Xo(e=""){N&&(e=Kn(e),Jt.dataset.path=wn(e),Jt.innerText=Hn(e).fileName,Jt.title=kn(e,!0))}function Yo(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>jt.style.display=En(Pt)==fe||qn(Gt)?"none":"";for(const n of e){switch(n){case kt:za.alphaBars=qn(kt);break;case xt:za.ansiBands=qn(xt);break;case Lt:const e=Lt.value[0],t=Lt[Lt.selectedIndex].idx,o=e!=X&&e!=Y;if(za.overlay=o,za.showBgColor=e==X,e==ee){zo(),Aa.style.display="";const e=dn[void 0===t?Wn(dn.length):t].url;Aa.src.endsWith(e)||(Aa.src=e)}else Aa.style.display="none",o?zo(e==Z?vn.src:cn[void 0===t?Wn(cn.length):t].url):zo();break;case Ct:const s=Ct.value,i=s==re||s==ce||s==de;It.classList.toggle("repeat",s==ie),It.classList.toggle("cover",s==oe||i),It.style.backgroundSize="",Pa.style.display=i?"":"none",Pa.classList.toggle("rotating",s==de),Pa.classList.toggle("paused",s==re);break;case $t:Mt.style.background=`rgba(0,0,0,${1-$t.value})`;break;case At:At.value==ne?window.showDirectoryPicker({startIn:"pictures"}).then((e=>{(0,D.hZ)(Le,e)})).catch((e=>{At.value=te,(0,D.yH)(Le)})).finally((()=>_o())):((0,D.yH)(Le),_o());break;case Tt:Co();break;case Et:za.barSpace=za.isLumiBars?1.5:En(Et);break;case Pt:za.channelLayout=En(Pt),a();break;case Ot:za.colorMode=En(Ot);break;case Rt:M([...ye,...ke,...Rt.checked?we:[]]),I();break;case Ft:za.fillAlpha=Qt.value==Be?1:Ft.value;break;case Dt:za.fftSize=Dt.value,oo("FFT size is "+za.fftSize+" samples");break;case Bt:za.frequencyScale=En(Bt);break;case Nt:wt.style.height=`${Nt.value}%`;break;case da:case ca:for(;+ca.value<=+da.value;)ca.selectedIndex++;za.setFreqRange(da.value,ca.value);break;case Ht:case jt:""===n.value&&(n.selectedIndex=0),qn(Gt)?za.gradient=Ht.value=jt.value=n.value:za[n==Ht?"gradientLeft":"gradientRight"]=n.value;break;case zt:za.ledBars=qn(zt);break;case Wt:za.linearAmplitude=qn(Wt);break;case Kt:za.lineWidth=Qt.value==Be?0:Kt.value;break;case Gt:a(),qn(Gt)&&Yo(Ht,!1);break;case Vt:za.loRes=qn(Vt);break;case Xt:za.lumiBars=qn(Xt),Yo(Et,!1);break;case Yt:za.maxFPS=Yt.value;break;case Qt:const l=Qt.value;[Be,Ne].includes(l)?za.mode=10:za.mode=l,l==Be?(za.lineWidth=0,za.fillAlpha=1):(za.lineWidth=Kt.value,za.fillAlpha=Ft.value),Yo(Et,!1);break;case Zt:za.mirror=En(Zt);break;case aa:za.noteLabels=qn(aa);break;case na:za.outlineBars=qn(na);break;case sa:Dn()&&(za.width=za.height*sa.value);break;case la:za.radial=qn(la),Yo(Et,!1);break;case ra:const r=ra.value;tn&&(tn=clearInterval(tn)),r>1&&(tn=setInterval(Io,2500*r));break;case ua:switch(En(ua)){case He:za.reflexRatio=.4,za.reflexAlpha=.2;break;case je:za.reflexRatio=.5,za.reflexAlpha=1;break;default:za.reflexRatio=0}break;case fa:za.roundBars=qn(fa);break;case ha:ha.checked?Gn(y):((0,D.yH)(Re),Mo(Re));break;case ma:ma.checked?os(!0):(0,D.yH)(De);break;case ba:za.showScaleX=qn(ba);break;case ga:za.showScaleY=qn(ga);break;case va:const c=En(va);za.setSensitivity(vt(`.min-db[data-preset="${c}"]`).value,vt(`.max-db[data-preset="${c}"]`).value),za.linearBoost=vt(`.linear-boost[data-preset="${c}"]`).value;break;case qt:za.showFPS=qn(qt);break;case wa:za.showPeaks=qn(wa);break;case La:za.smoothing=La.value,oo("smoothingTimeConstant is "+za.smoothing);break;case Ea:za.spinSpeed=Ea.value;break;case $a:za.splitGradient=qn($a);break;case Oa:za.weightingFilter=En(Oa)}t&&(Na.includes(n)?No(Ie):cs())}}async function Zo(){Va=Sa.checked,Va?N&&!await electron.api("ask-for-media-access")||!navigator.mediaDevices?(oo("Cannot access user microphone",!0),Sa.checked=Va=!1):navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Xa=za.audioCtx.createMediaStreamSource(e),Fn()&&rn[Ka].pause(),ln=ea.checked,rs(!0),za.connectInput(Xa),oo("Audio source set to microphone")})).catch((e=>{oo(`Could not change audio source - ${e}`,!0),Sa.checked=Va=!1})):(Xa&&(za.disconnectInput(Xa),Xa.mediaStream.getTracks()[0].stop(),Xa=null,rs(ln)),oo("Audio source set to built-in player"))}function Qo(e){Ta.dataset.value=e,za.volume=e**2.5,Ta.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function es(){const e=vt("#toggle_settings");e.addEventListener("click",(()=>{vt("#settings").classList.toggle("active",e.classList.toggle("active"))})),vt(".settings-close").addEventListener("click",(()=>e.click()));const t=vt("#toggle_console");let a;t.addEventListener("click",(()=>{vt("#console").classList.toggle("active",t.classList.toggle("active")),t.classList.remove("warning"),oo()})),vt("#console-close").addEventListener("click",(()=>t.click())),vt("#console-clear").addEventListener("click",(()=>oo("Console cleared.",!1,!0))),yt(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,Yo(e)}))})),yt("[data-prop]").forEach((e=>{Mn(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>Yo(e)))})):e.addEventListener("change",(()=>{Yo(e),ds(e)}))})),Sa.addEventListener("change",Zo),ea.addEventListener("change",(()=>rs())),[Ta,St].forEach((e=>{e.addEventListener("wheel",(t=>{if(t.preventDefault(),a)return;a=setTimeout((()=>a=!1),50);const n=Math.sign(t.deltaY||0);e==Ta?ao(n):eo(n)}))})),St.addEventListener("dblclick",(()=>{eo(0)})),vt("#btn_play").addEventListener("click",(()=>So())),vt("#btn_stop").addEventListener("click",ns),vt("#btn_shuf").addEventListener("click",ts),vt("#btn_prev").addEventListener("mousedown",(()=>Uo("m",-1))),vt("#btn_prev").addEventListener("click",(e=>{uo()||as(!0)})),vt("#btn_next").addEventListener("mousedown",(()=>Uo("m"))),vt("#btn_next").addEventListener("click",(()=>{uo()||as()})),vt("#load_preset").addEventListener("click",(()=>{const e=[];Ia.forEach((t=>{_n(t.options)||e.push({text:t.name+("default"==t.key?" (warning: resets Volume!)":""),handler:()=>yo(t.key)})})),e.push({text:"<strong>USER PRESETS →</strong>",handler:()=>{const e=[];On().forEach(((t,a)=>{e.push({text:t,handler:()=>yo(a)})})),B().select({text:"LOAD PRESET:",choices:e})}}),B().select({text:"LOAD PRESET:",choices:e})})),vt("#btn_save").addEventListener("click",(()=>{const e=[];On().forEach(((t,a)=>{const n=sn[a].options;e.push({type:1,text:t,handler:()=>jo(a,$n())},{type:2,text:_n(n)?"":'<button title="Edit name">&#xf11f;</button>',handler:()=>jo(a,n,"",!0)},{type:2,text:_n(n)?"":'<button title="Delete preset">&#xf120;</button>',handler:()=>ro(a)})})),B().select({text:"<strong>Click slot to SAVE - Use buttons to Edit or Delete</strong>",choices:e})})),vt("#btn_fullscreen").addEventListener("click",po),vt("#save_playlist").addEventListener("click",(()=>{if(N){const e=Jt.dataset.path;e?B().confirm({text:`<strong>${Jt.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>Bo(e,!0),cancelCallback:()=>B().alert({text:"Canceled"})}):Bo()}else e=ia.selectedIndex,""==ia[e].value?os():ia[e].dataset.isLocal?B().confirm({text:`Overwrite "${ia[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{os(ia[e].value)},cancelCallback:()=>{B().alert({text:"Canceled"})}}):B().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),vt("#create_playlist").addEventListener("click",(()=>N?Bo():os())),vt("#btn_clear").addEventListener("click",(()=>{!function(){for(;Qa.hasChildNodes();)Fo(Qa.removeChild(Qa.firstChild));Fn()?en=-1:(en=0,no(Ka)),no(Ya),ls()}(),Xo(),os(!0)})),(N?vt(".playlist-bar"):Jt).style.display="none",N||(vt("#load_playlist").addEventListener("click",(()=>{vo({file:ia.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;B().alert({text:t,time:5})}))})),vt("#delete_playlist").addEventListener("click",(()=>{return e=ia.selectedIndex,void(ia[e].dataset.isLocal?B().confirm({text:`Do you really want to DELETE the "${ia[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=ia[e].value,a=qe+t,n=await(0,D.Jt)(_e);n&&delete n[t],await(0,D.yH)(a),await(0,D.hZ)(_e,n),B().alert({text:"Playlist deleted"}),ko()},cancelCallback:()=>{B().alert({text:"Canceled"})}}):ia[e].value&&B().alert({text:"Cannot delete a server playlist!"}));var e}))),oa.addEventListener("click",(()=>is()));const n=vt("#btn_toggle_filesystem"),o=()=>n.innerText="Switch to "+(on?"Server":"Device");(Ja||on)&&nn?(o(),n.addEventListener("click",(async()=>{on=!on;const e=await(on?(0,D.Jt)(Re):bo(Re));var t;on&&e&&"granted"!=await e[0].handle.requestPermission()?on=!1:(S=!S,y=[],f=null,w=[S?d:i],(t=e)?R(t):E(),o(),Ho(Oe,on))}))):n.style.display="none";const s=vt("#btn_add_selected"),l=vt("#btn_add_folder");N||Ja||on?(s.addEventListener("mousedown",(()=>Xn(A(".selected")))),l.addEventListener("click",(()=>Xn(A())))):(s.style.display="none",l.style.display="none");const r=vt("#local_file");let c,u;N||nn?r.parentElement.style.display="none":r.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){no();const e=rn[Ka];mo(t,e,!0),_.Xs(t).then((t=>Yn(t,e))).catch((e=>{}))}}(e.target))),vt("#btn_load_url").addEventListener("click",(()=>{B().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&(Qn({file:e},!0),os(!0))}})}));const p=vt("#btn_pip");document.pictureInPictureEnabled?p.addEventListener("click",(async()=>{if(yn!==document.pictureInPictureElement){const e=za.canvas.captureStream();c=e.getTracks()[0],yn.muted=!0,yn.srcObject=e,await yn.play(),yn.requestPictureInPicture()}else document.exitPictureInPicture()})):p.classList.add("disabled");const h=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>za.setCanvasSize(u.width,u.height)));yn.addEventListener("enterpictureinpicture",(e=>{u=e.pictureInPictureWindow,It.classList.add("pip"),p.classList.add("active"),za.setCanvasSize(u.height*sa.value,u.height),u.addEventListener("resize",h)})),yn.addEventListener("leavepictureinpicture",(()=>{u.removeEventListener("resize",h),yn.pause(),c.stop(),yn.srcObject=c=null,p.classList.remove("active"),It.classList.remove("pip"),za.setCanvasSize()}));const m=navigator.mediaSession;m&&(m.setActionHandler("play",(()=>So())),m.setActionHandler("pause",(()=>So())),m.setActionHandler("previoustrack",(()=>Eo())),m.setActionHandler("nexttrack",(()=>Lo()))),vt("#add-gradient").addEventListener("click",xo),vt("#btn-save-gradient").addEventListener("click",qo),vt("#btn-delete-gradient").addEventListener("click",lo),vt("#new-gradient-bkgd").addEventListener("input",(e=>{un.bgColor=e.target.value})),vt("#new-gradient-name").addEventListener("input",(e=>{un.name=e.target.value})),vt("#new-gradient-horizontal").addEventListener("input",(e=>{un.dir=e.target.checked?"h":void 0}))}function ts(){for(let e=zn()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=Qa.replaceChild(Qa.children[t],Qa.children[e]);Qa.insertBefore(a,Qa.children[t])}$o(0)}function as(e=!1){(e?Eo():Lo())||Ko(`Already at ${e?"first":"last"} track`)}function ns(){rn[Ka].pause(),Ko(),wo(0)}async function os(e,t=!0){const a=1==e;if(!a||ma.checked)if(0!=zn()||a)if(e){let n=e;if(!a&&!t){n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=n.toLowerCase().replace(/[^a-z0-9]/g,"_");let t=await(0,D.Jt)(_e)||{},a=0,o=n;for(;t.hasOwnProperty(n)&&a<100;)n=o+"_"+a,a++;t[n]=e,await(0,D.hZ)(_e,t),ko(n)}let o=[];for(const e of Qa.childNodes)o.push({file:e.dataset.file,handle:e.handle});a?(0,D.hZ)(De,o):(0,D.hZ)(qe+n,o).then((()=>B().alert({text:"Playlist saved!"})))}else B().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&os(e,!1)},cancelCallback:()=>{B().alert({text:"Canceled"})}});else B().alert({text:"Queue is empty!"})}function ss(e){for(const t of rn)t.dataset.file==e.dataset.file&&Yn(e,t)}function is(){Wa.endTime<performance.now()&&(Wa.info=0),2==Wa.info?Ko():Ko(1+(0|Wa.info),+Ut.value||1/0)}function ls(){const e=Qa.querySelector(".current"),t=Qa.children[en];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function rs(e){void 0!==e?ea.checked=e:e=ea.checked,e?za.disconnectOutput():za.connectOutput()}function cs(){Ho(Me,{...$n(),volume:Ta.dataset.value,balance:St.dataset.value})}function ds(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){let e,t,a,o,s,u,k,A,T,P,O,I,_;const q=e=>{Lo(!0)||(wo(0),Ko("Queue ended",10),Dn()&&yn.pause())},H=e=>{e.target.attributes.src&&oo("Error loading "+e.target.src,!0)},j=e=>{rn[Ka].attributes.src?(Dn()&&yn.play(),rn[Ka].currentTime<.1&&"1"==ra.value&&Io(!0),qn(xa)&&Ko(1,+Ca.value||1/0)):$o(en)};window.addEventListener("error",(e=>oo(`Unexpected ${e.error}`,!0)));let U=!1;oo(`audioMotion v${K} initializing...`),oo(`User agent: ${navigator.userAgent}`),vt("#version").innerText=K;const z=await fetch(ht);let G=200==z.status?await z.text():null;try{G=JSON.parse(G)}catch(e){oo(`Error parsing ${ht} - ${e}`,!0),G={}}G={...mt,...G},nn=G.enableLocalAccess&&!!window.showDirectoryPicker;const J=new URL(document.location).searchParams.get("mode");let V=G.enableLocalAccess&&(J==xe||"server"!=J&&await bo(Oe));null===V&&(V=G.defaultAccessMode==xe),N&&oo(`Reading user preferences from ${await electron.api("storage-info")}`);const X=await async function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},t=await bo(Me),a=null!==t;((e,t)=>{const a=Cn("last");-1!=a&&(Ia[a].options=t)})(0,{...An("default"),...t}),sn=await bo(Ee)||[],Array.isArray(sn)||(sn=[{name:"Custom",options:sn}]);for(let e=0;e<9;e++)void 0===sn[e]?sn[e]={}:_n(sn[e])||sn[e].options||(sn[e]={options:sn[e]});e(await bo(Ae),Ra),e(await bo($e),Ba);const n=await bo(Se);n&&Object.keys(n).forEach((e=>{Ma[e]=n[e]})),e(await bo(Ce),Ma),e(await bo(Te),Da);const o=yt(".min-db");o.forEach((e=>Vn(e,-120,-60)));const s=yt(".max-db");s.forEach((e=>Vn(e,-50,0)));const i=yt(".linear-boost");i.forEach((e=>Vn(e,1,5,.2))),(await bo(Fe)||Fa).forEach(((e,t)=>{o[t].value=e.min,s[t].value=e.max,i[t].value=e.boost||Fa[t].boost})),Vo({...qa,...await bo(Pe)||{}});for(let e=10;e<16;e++)Dt[Dt.options.length]=new Option(2**e);return Vn(La,0,.9,.1),Oo(sa,Ua),Vn(Nt,25,100,5),Oo(Yt,ja),Oo(At,[[te,"Disable"],[ae,"Server"],[...nn?[ne,"Local device"]:[]]]),Vn(Tt,0,100),Jo({...Ha,...await bo(Ie)||{}}),a}();Qa=vt("#playlist"),Qa.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&($o(Ln(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),en=0,F.Ay.create(Qa,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{en=Ln(Qa.querySelector(".current")),0!=e.newIndex||Fn()||wo(0),go(),os(!0)}}),oo(`Instantiating audioMotion-analyzer v${n.A.version}`),za=new n.A(wt,{fsElement:It,onCanvasDraw:(n,i)=>{const l=rn[Ka],r=l.dataset,c=l.duration-l.currentTime,d=+_t.value,p=Lt.value[0],f=Ct.value,h=qn(ta),m=za.pixelRatio,{timestamp:b}=i;if(c<.1&&Lo(!0),d>0&&c<=d&&qn(xa)&&b>Wa.endTime&&Fn()&&Ko(1,c,1),!(f!=le&&"4"!=f&&"5"!=f||p!=Z&&p!=Q)){let e;if(f==le)e=(70*za.getEnergy()|0)-25;else{const t=l.currentTime/l.duration;e=100*("4"==f?t:1-t)}It.style.backgroundSize=`auto ${100+e}%`}oa.width|=0;const{endTime:g,startTime:v,msgTimer:y,info:w,msg:x,fade:L}=Wa;if(b>g&&b>y)return;const S=(e,t,a,n)=>{h?(gn.strokeText(e,t,a,n),gn.fillText(e,t,a,n)):(gn.shadowOffsetX=gn.shadowOffsetY=3*m,gn.fillText(e,t,a,n),gn.shadowOffsetX=gn.shadowOffsetY=0)};if(gn.lineWidth=4*m,gn.lineJoin="round",gn.font=I,gn.textAlign="center",gn.fillStyle="#fff",gn.strokeStyle=gn.shadowColor="#000",y>b&&(b>g||2!=w)){const e=(y-b)/1e3;gn.globalAlpha=e>1?1:e,S(Wa.msg,a,s)}if(g>b){if(L<0){const e=(g-b)/1e3;gn.globalAlpha=e>-L?1:e/-L}else{const e=Math.max(0,(b-v)/1e3);gn.globalAlpha=e>L?1:e/L}if(2==Wa.info&&(S(Pn(),a,s,P),gn.textAlign="left",S(Sn(Qt),e,s,P),S(`Randomize: ${Sn(ra)}`,e,u,P),gn.textAlign="right",S(Sn(va).toUpperCase()+" sensitivity",o,s,P),S(`Repeat is ${Nn(pa)}`,o,u,P)),Va)gn.textAlign="left",gn.font=_,S("MIC source",e,A,O);else{gn.textAlign="right",S(r.codec,o,k),S(r.quality,o,k+e);const a=zn();a&&ya.checked&&S(`Track ${(""+(en+1)).padStart((""+a).length,"0")} of ${a}`,o,k-e),gn.textAlign="left",S(r.artist.toUpperCase(),e,k,O),gn.font=`italic ${I}`,S(r.album,e,T,O),gn.font=_,S(l.src?r.title:"No song loaded",e,A,O),(l.duration||r.duration)&&(r.duration||(r.duration=Jn(l.duration),Qa.children[en]&&(Qa.children[en].dataset.duration=r.duration)),gn.textAlign="right",S(Jn(l.currentTime)+" / "+r.duration,o,T)),vn.width&&ka.checked&&gn.drawImage(vn,e,k-1.3*t,t,t)}}},onCanvasResize:(n,i)=>{let l;const r=i.pixelRatio,c=oa.width=It.clientWidth*r,d=oa.height=It.clientHeight*r;switch(n){case"create":oo(`Display resolution: ${i.fsWidth} x ${i.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),l="Canvas created";break;case"lores":l=`Lo-res ${i.loRes?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":l=(i.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"resize":l="Window resized";break;case"user":l=(Dn()?"Resized for":"Closed")+" PIP"}oo(`${l||n}. Canvas size is ${i.canvas.width} x ${i.canvas.height} px`),e=Math.min(c,d)/17,t=3*e,a=c/2,o=c-e,s=1.4*e,u=1.8*s,P=c/3-e,k=d-4*e,A=d-2.8*e,T=d-1.6*e,O=c-7*e,I=`bold ${.7*e}px sans-serif`,_=`bold ${e}px sans-serif`}});const Y=za.audioCtx;Y.createStereoPanner&&(Za=Y.createStereoPanner(),za.connectInput(Za)),Ka=0,Ya=1;for(const e of[0,1])rn[e]=vt(`#player${e}`),no(e),rn[e].addEventListener("play",j),rn[e].addEventListener("ended",q),rn[e].addEventListener("error",H),Za?Y.createMediaElementSource(rn[e]).connect(Za):za.connectInput(rn[e]);!function(){const e=(e,t,a,n,o)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),yt(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return B().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,Oo(n,a),No(o))}))}))};e(vt("#enabled_modes"),"enabledMode",Ra,Qt,Ae),e(vt("#enabled_bgfit"),"enabledBgFit",Ba,Ct,$e);const t=vt("#enabled_gradients");Object.keys(Ma).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${Ma[e].disabled?"":"checked"}> ${Ma[e].name}</label>`})),To();const a=vt("#random_properties");Da.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),yt(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{Da.find((t=>t.value==e.value)).disabled=!e.checked,No(Te)}))})),yt("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;vt(`.min-db[data-preset="${t}"]`).value=Fa[t].min,vt(`.max-db[data-preset="${t}"]`).value=Fa[t].max,vt(`.linear-boost[data-preset="${t}"]`).value=Fa[t].boost,yt(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==En(va)&&Yo(va,!1),No(Fe)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==En(va)&&Yo(va,!1),No(Fe)),e.classList.toggle("field-error",!t)}))}));for(const e of[Ut,Ca,_t,ka,ya])e.addEventListener("change",(()=>No(Pe)));vt("#reset_osd").addEventListener("click",(()=>{Vo(qa),No(Pe)})),Na.forEach((e=>{e.addEventListener("change",(()=>Yo(e)))})),vt("#reset_general").addEventListener("click",(()=>{Jo(Ha),Yo(Na)}))}(),Oo(Qt,Ra);for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])da[da.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])ca[ca.options.length]=new Option(e/1e3+"kHz",e);Ao(Pt,_a),Ao(va,[["0","Low"],["1","Normal"],["2","High"]]),Ao(Et,[["1.5","Min"],["0.1","10"],["0.25","25"],["0.5","50"],["0.75","75"]]),Oo(ra,[["0","OFF"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),Ao(ua,[["0","Off"],["1","On"],["2","Full"]]),Oo(Ct,Ba),Ao(Zt,[["-1","Left"],["0","Off"],["1","Right"]]),Ao(Bt,[[dt,"Bark"],["linear","Lin"],[ut,"Log"],["mel","Mel"]]),Ao(Oa,[["","OFF"],["A","A"],["B","B"],["C","C"],[bt,"D"],["468","468"]]),Ao(Ot,[[he,"Gradient"],[me,"Index"],[be,"Level"]]),Vn($t,.1,1,.1),Vn(Kt,1,3,.5),Vn(Ft,0,.5,.1),Vn(Ea,0,3,1),Ko(),Object.keys(Ma).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=Ma[e];n&&za.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),Po(),Zo();const ee=function(e,t={}){let a;return b=document.createElement("ul"),b.className="breadcrumb",e.append(b),g=document.createElement("ul"),g.className="filelist",e.append(g),a=setTimeout((()=>{b.innerHTML="Waiting for server..."}),5e3),b.innerHTML="Initializing... please wait...",b.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=y.pop(),e--;const a=y[y.length-1];a&&a.handle&&(f=a.handle,t=null),$(t,t&&t.scrollTop)}(e.target.dataset.depth)})),g.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)$(t.handle||t.dataset.path);else if("mount"==t.dataset.type)if(S)try{f=await window.showDirectoryPicker({startIn:"music"}),y=[],$(f)}catch(e){}else y=[],$(t.dataset.path)})),g.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&h&&["file","list"].includes(t.dataset.type)&&h({file:C(t.dataset.path),handle:t.handle},e)})),"function"==typeof t.onDblClick&&(h=t.onDblClick),"function"==typeof t.onEnterDir&&(m=t.onEnterDir),t.fileExtensions&&M(t.fileExtensions),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async n=>{if(clearTimeout(a),n.startsWith("audioMotion")?(x=!0,v=1):v=p,1==v&&l){const e=await fetch("/getMounts");w=await e.json(),R(await async function(){const e=await fetch("/getHomeDir"),t=await e.text();let a=[];for(const e of t.split(r?"\\":"/"))a.push({dir:e,scrollTop:0});return a}())}else w=[t.rootPath||i],L=await $(w[0]),(t.forceFileSystemAPI&&c||!L)&&(y=[],c?(w=[d],S=!0):w=[],E());e({serverMode:v,useFileSystemAPI:S,hasServerMedia:L,filelist:g,serverSignature:v==p?"Standard web server":n})})).catch((t=>{clearTimeout(a),v=-1,c?(w=[d],S=!0):w=[],E(),e({serverMode:v,useFileSystemAPI:S,filelist:g})}))}))}(vt("#file_explorer"),{onDblClick:(e,t)=>{Xn([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{ha.checked&&U&&Gn(e)},fileExtensions:[...ye,...ke,...Rt.checked?we:[]],forceFileSystemAPI:V}).then((e=>{an=e.serverMode,Ja=e.hasServerMedia,on=e.useFileSystemAPI;const{filelist:t,serverSignature:a}=e;an!=ft&&oo(`${a} detected at ${W}`),Ja||oo(an==ft?"No server found":"Cannot access music directory on server",!0),on&&oo("Accessing files from local device via File System Access API."),!nn&&G.enableLocalAccess&&oo("No browser support for File System Access API. Cannot access files from local device.",V),N||(Ho(Oe,V&&nn),ko()),(N||on||Ja)&&F.Ay.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{if("playlist"==e.to.id){let t=e.items.length?e.items:[e.item],a=[];t.forEach((e=>{a.push(Qn({file:C(e.dataset.path),handle:e.handle})),e.remove()})),Promise.all(a).then((()=>os(!0)))}}}),es()}));window.addEventListener("keydown",fo),window.addEventListener("keyup",fo),B().setOptions({positions:{alert:"bottom"}}),Promise.all([_o(),ee]).then((async()=>{const e=()=>{n&&R(n),ma.checked&&vo({file:!0})},t=async()=>{!(s&&"granted"!=await o.requestPermission()||i&&"granted"!=await n[0].handle.requestPermission())&&(a.classList.remove("locked"),window.removeEventListener("click",t),s&&_o(),e())},a=vt("#files_panel"),n=await(on?(0,D.Jt)(Re):bo(Re)),o=await(0,D.Jt)(Le),s=nn&&o&&"granted"!=await o.queryPermission(),i=on&&Array.isArray(n)&&n[0]&&"granted"!=await n[0].handle.queryPermission();oo(`Loading ${X?"last session":"default"} settings`),yo("last",!1,!0),s||i?(a.classList.add("locked"),window.addEventListener("click",t)):e(),oo(`AudioContext sample rate is ${Y.sampleRate}Hz; Total latency is ${1e3*((Y.outputLatency||0)+Y.baseLatency)|0}ms`),oo("Initialization complete!"),U=!0}))}()},6216:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,l=this.offsetLeft-t.offsetLeft<t.scrollLeft,r=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!i;(s||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(l||r)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||i||l||r)&&!e&&this.scrollIntoView(c)})},143:()=>{},3411:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],l=!0,r=0;r<a.length;r++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](a[r])))?a.splice(r--,1):(l=!1,s<i&&(i=s));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[i,l,r]=a,c=0;if(i.some((t=>0!==e[t]))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(r)var d=r(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96],(()=>n(6965)));o=n.O(o)})();
//# sourceMappingURL=audioMotion.js.map