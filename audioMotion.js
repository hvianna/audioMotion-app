/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={2301:(e,t,a)=>{"use strict";var n=a(6708);const o=JSON.parse('{"i8":"24.2.0-beta.0"}'),s=location.origin+location.pathname,l="electron"in window,i=l&&/Windows/.test(navigator.userAgent),r=!!window.showDirectoryPicker,c="Click to open a new root folder",d="Click to open directory",u="No music found on server and no browser support for File System API",p=0;let f,h,m,b,g,v,y,k=[],w=[],x=!1,S=!1,L=!1,E=!1;function C(e,t){g.innerHTML="",v.innerHTML="",v.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.innerText=n,a.handle=e.handle,v.append(a)},n=e=>v.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==w.length&&(g.innerHTML=u),k.forEach((({dir:e},t)=>{g.innerHTML+=`<li data-depth="${k.length-t-1}">${e}</li> ${i?"\\":"/"==e?"":"/"} `})),x)v.innerHTML+=`<li data-type="request" class="full-panel">${d}</li>`;else if(w.forEach((e=>{v.innerHTML+=`<li data-type="mount" ${E&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),k.length>1&&(v.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),E&&t?t.handle.getFile().then((e=>{const t=URL.createObjectURL(e);n(t)})):n(t?T(t):"")}v.scrollTop=t||0}function $(e,t){let a,n,o=e&&"string"!=typeof e?e:null;if(o&&(e=o.name),e)if(".."==e){a=k.pop();const e=k[k.length-1];e&&e.handle&&(o=e.handle)}else k.push({dir:e,scrollTop:v.scrollTop,handle:o});return v.innerHTML="<li>Loading...</li>",n=T(),new Promise((async e=>{const s=n=>{!1!==n&&(S&&!E||(n=O(n)),C(n,t||a&&a.scrollTop),m&&m(k),e(!0)),e(!1)};if(f){o&&(f=o);let e=[];for await(const t of f.entries())e.push(t);s(e)}else fetch(n).then((e=>200==e.status&&(S?e.json():e.text()))).then((e=>s(e))).catch((()=>e(!1)))}))}function T(e,t){let a="";return k.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=a.replace(/#/g,"%23"),l?(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)):y==p&&(a=s+a),a}function A(e="li"){let t=[];return v.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:T(e.dataset.path),handle:e.handle,type:e.dataset.type})})),t}async function I(e){const t=[...k],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();".."==e?(t.pop(),n=t[t.length-1].handle):(n=await n.getDirectoryHandle(e),t.push({handle:n}))}return await n.getFileHandle(a.shift())}function P(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,n]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i);a.push({uri:t,file:n})}return a}function O(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp3|flac|m4a|aac|ogg|wav|m3u|m3u8)$/i;let n=[],o=[],s=[];const l=(e,a)=>{const n=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(E)for(const[l,i]of e)i instanceof FileSystemDirectoryHandle?o.push({name:l,handle:i}):i instanceof FileSystemFileHandle&&(l.match(t)?s.push({name:l,handle:i}):l.match(a)&&n.push({name:l,handle:i}));else for(const{uri:l,file:i}of P(e))"/"==l.substring(l.length-1)?i.match(/(parent directory|\.\.)/i)||("/"==i.substring(i.length-1)?o.push(i.substring(0,i.length-1)):o.push(i)):i.match(t)?s.push(i):i.match(a)&&n.push(i);const i=(e,t)=>{const a="object"==typeof e;return(new Intl.Collator).compare(...a?[e.name,t.name]:[e,t])};return{cover:l(s,"cover")||l(s,"folder")||l(s,"front")||s[0],dirs:o.sort(i),files:n.sort(i)}}async function M(e){if(!e)return!1;const t=[...k],a=e[e.length-1];k=e,a&&a.handle&&(f=a.handle);const n=await $();return n||(k=t),n}var _=a(2463),R=(a(7379),a(4678)),D=a(1474),F=a(3681),B=a.n(F);D.ZP.mount(new D.LJ);const q="electron"in window,N=q&&/Windows/.test(navigator.userAgent),H=!!window.showDirectoryPicker,j="/getFile/",z="/getCover/",U="/savePlist/",K=location.origin+location.pathname,W=o.i8,G=q?"/getBackground":"backgrounds",Y=4,X=1e3,V="0",J="1",Z="2",Q="3",ee="4",te="0",ae="1",ne="2",oe="3",se="6",le="7",ie="8",re={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},ce="dual-combined",de="single",ue="gradient",pe="bar-index",fe="bar-level",he="10",me="101",be="1",ge="2",ve="alpha",ye="nobg",ke="barSp",we="imgfit",xe="stereo",Se="colormode",Le="fill",Ee="gradient",Ce="leds",$e="line",Te="lumi",Ae="mirror",Ie="mode",Pe="outline",Oe="peaks",Me="presets",_e="radial",Re="spin",De="reflex",Fe="round",Be="split",qe=1,Ne=-1,He="bark",je="log",ze="D",Ue="custom-grads",Ke="custom-preset",We="disabled-bgfit",Ge="disabled-gradients",Ye="disabled-modes",Xe="disabled-properties",Ve="display-options",Je="force-filesystem",Ze="general-settings",Qe="last-config",et="last-dir",tt="playlists",at="sensitivity-presets",nt="No description",ot=document.querySelector.bind(document),st=document.querySelectorAll.bind(document),lt=ot("#alpha_bars"),it=ot("#analyzer"),rt=ot("#ansi_bands"),ct=ot("#background"),dt=ot("#balance"),ut=ot("#bar_space"),pt=ot("#bg_img_dim"),ft=ot("#bg_img_fit"),ht=ot("#channel_layout"),mt=ot("#color_mode"),bt=ot("#bg_container"),gt=ot("#bg_dim"),vt=ot("#end_timeout"),yt=ot("#fft_size"),kt=ot("#fill_alpha"),wt=ot("#fps"),xt=ot("#freq_scale"),St=ot("#fs_height"),Lt=ot("#gradient"),Et=ot("#gradientRight"),Ct=ot("#info_timeout"),$t=ot("#led_display"),Tt=ot("#linear_amplitude"),At=ot("#line_width"),It=ot("#link_grads"),Pt=ot("#loaded_playlist"),Ot=ot("#lo_res"),Mt=ot("#lumi_bars"),_t=ot("#max_fps"),Rt=ot("#mirror"),Dt=ot("#mode"),Ft=ot("#mute"),Bt=ot("#no_shadow"),qt=ot("#note_labels"),Nt=ot("#outline"),Ht=ot("#osd"),jt=ot("#pip_ratio"),zt=ot("#playlists"),Ut=ot("#radial"),Kt=ot("#random_mode"),Wt=ot("#freq_max"),Gt=ot("#freq_min"),Yt=ot("#reflex"),Xt=ot("#repeat"),Vt=ot("#round_bars"),Jt=ot("#save_dir"),Zt=ot("#scaleX"),Qt=ot("#scaleY"),ea=ot("#sensitivity"),ta=ot("#show_count"),aa=ot("#show_cover"),na=ot("#show_peaks"),oa=ot("#show_song"),sa=ot("#smoothing"),la=ot("#source"),ia=ot("#spin"),ra=ot("#split_grad"),ca=ot("#track_timeout"),da=ot("#video"),ua=ot("#volume"),pa=ot("#warp"),fa=ot("#weighting"),ha=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:te,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:je,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",noteLabels:1,outlineBars:0,radial:0,randomMode:0,reflex:be,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:ze}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:ae,channelLayout:de,colorMode:ue,freqMax:2e4,freqMin:25,freqScale:je,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",noteLabels:0,radial:0,randomMode:0,reflex:"0",roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:ze}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:Z,bgImageDim:.3,bgImageFit:ae,channelLayout:ce,colorMode:ue,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:He,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:me,noteLabels:0,radial:0,randomMode:0,reflex:"0",showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:ze}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:Z,barSpace:.1,bgImageDim:.3,bgImageFit:oe,channelLayout:de,colorMode:fe,freqMax:2e4,freqMin:20,freqScale:je,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",noteLabels:0,outlineBars:0,radial:1,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:1,splitGrad:0,weighting:ze}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:Z,barSpace:.25,bgImageDim:.3,bgImageFit:le,channelLayout:de,colorMode:pe,freqMax:2e4,freqMin:20,freqScale:je,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:ge,roundBars:1,showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:ze}},{key:"last",name:"Last session",options:{}},{key:"default",name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:V,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:ae,channelLayout:de,colorMode:ue,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:je,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,mirror:0,mode:"0",noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:"0",repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:1,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""}}],ma={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},rainbow:{name:"Rainbow",disabled:!1},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},ba=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:he,text:"Area graph",disabled:!1},{value:me,text:"Line graph",disabled:!1},{value:"8",text:"Octave bands / 10 bands",disabled:!1},{value:"7",text:"1/2 octave / 20 bands",disabled:!1},{value:"6",text:"1/3 octave / 30 bands",disabled:!1},{value:"5",text:"1/4 octave / 40 bands",disabled:!1},{value:"4",text:"1/6 octave / 60 bands",disabled:!1},{value:"3",text:"1/8 octave / 80 bands",disabled:!1},{value:"2",text:"1/12 octave / 120 bands",disabled:!1},{value:"1",text:"1/24 octave / 240 bands",disabled:!1}],ga=[[de,"Singl"],[ce,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],va=[{value:ve,text:"Alpha",disabled:!1},{value:Ie,text:"Analyzer Mode",disabled:!1},{value:ye,text:"Background",disabled:!1},{value:ke,text:"Bar Spacing",disabled:!1},{value:we,text:"BG Image Fit",disabled:!1},{value:xe,text:"Channel Layout",disabled:!1},{value:Se,text:"Color Mode",disabled:!1},{value:Le,text:"Fill Opacity",disabled:!1},{value:Ee,text:"Gradients",disabled:!1},{value:Ce,text:"LEDs",disabled:!1},{value:$e,text:"Line Width",disabled:!1},{value:Te,text:"Lumi",disabled:!1},{value:Ae,text:"Mirror",disabled:!1},{value:Pe,text:"Outline",disabled:!1},{value:Oe,text:"Peaks",disabled:!1},{value:_e,text:"Radial",disabled:!1},{value:Re,text:"Radial Spin",disabled:!1},{value:De,text:"Reflex",disabled:!1},{value:Fe,text:"Round",disabled:!1},{value:Be,text:"Split",disabled:!1},{value:Me,text:"User Presets",disabled:!0}],ya=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],ka={info:5,track:10,end:0,covers:!0,count:!0},wa=[{value:te,text:"Adjust",disabled:!1},{value:ae,text:"Center",disabled:!1},{value:oe,text:"Pulse",disabled:!1},{value:ne,text:"Repeat",disabled:!1},{value:se,text:"Warp",disabled:!1},{value:le,text:"Warp Drive",disabled:!1},{value:ie,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],xa=[yt,St,_t,jt,Jt,sa],Sa={fftSize:8192,fsHeight:100,maxFPS:60,pipRatio:2.35,saveDir:!0,smoothing:.7},La=[[30,"30"],[60,"60"],[0,"unlimited"]],Ea=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let Ca,$a,Ta,Aa,Ia,Pa,Oa,Ma,_a,Ra,Da,Fa,Ba,qa,Na,Ha,ja=[],za=[],Ua=[],Ka=null,Wa={},Ga=!1,Ya=!1,Xa=!1,Va=0;const Ja=Ht.getContext("2d"),Za=new Image,Qa=document.createElement("video"),en=(e,t)=>e.replace(/(%2f|\/)/g,t&&N?"\\":"/"),tn=e=>e.replace(/\//g,"%2f"),an=e=>Math.round(100*e)/100,nn=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},on=e=>{let t="";if(hn(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},sn=e=>hn(e)?e.elements[e.dataset.prop].value:void 0!==e.dataset.active?e.dataset.active:e.value,ln=e=>({alphaBars:sn(lt),ansiBands:sn(rt),background:sn(ct),barSpace:sn(ut),bgImageDim:sn(pt),bgImageFit:sn(ft),channelLayout:sn(ht),colorMode:sn(mt),fillAlpha:sn(kt),freqMax:sn(Wt),freqMin:sn(Gt),freqScale:sn(xt),gradient:sn(Lt),gradientRight:sn(Et),ledDisplay:sn($t),linearAmpl:sn(Tt),lineWidth:sn(At),linkGrads:sn(It),loRes:sn(Ot),lumiBars:sn(Mt),mirror:sn(Rt),mode:sn(Dt),noShadow:sn(Bt),noteLabels:sn(qt),outlineBars:sn(Nt),radial:sn(Ut),randomMode:sn(Kt),reflex:sn(Yt),repeat:sn(Xt),roundBars:sn(Vt),sensitivity:sn(ea),showFPS:sn(wt),showPeaks:sn(na),showScaleX:sn(Zt),showScaleY:sn(Qt),showSong:sn(oa),spin:sn(ia),splitGrad:sn(ra),weighting:sn(fa)}),rn=e=>{const t=+e==e?e:ha.findIndex((t=>t.key==e));return t<0||t>ha.length-1?-1:t},cn=e=>{const t=rn(e);return-1==t?{}:ha[t].options},dn=e=>{const t=rn(e);return-1!=t&&ha[t].name},un=()=>{const e=sn(ht)!=de&&!yn(It);return`Gradient${e?"s":""}: ${ma[Lt.value].name+(e?" / "+ma[Et.value].name:"")}`},pn=()=>Na.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${bn(e)?'<em class="empty">Empty slot</em>':e.name||nt}`)),fn=e=>e.startsWith("blob:"),hn=e=>"FORM"==e.tagName&&null!=e.dataset.prop,mn=e=>e.startsWith("http")&&!e.startsWith(K),bn=e=>!e||"object"!=typeof e||!Object.keys(e).length,gn=e=>bt.classList.contains("pip"),vn=(e=ja[Ta])=>e&&e.currentTime>0&&!e.paused&&!e.ended,yn=e=>"1"==e.dataset.active,kn=e=>e.replace(/\\/g,"/"),wn=e=>yn(e)?"ON":"OFF",xn=e=>{const t=$n(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),l=s>=0?o.slice(0,s):o,i=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:l,extension:i}},Sn=e=>{e=e.replace(/_/g," ");const[,,t,a,,n,o]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{artist:n,title:o,duration:","==a?An(t):""}},Ln=e=>(q&&!mn(e)&&(e.startsWith(j)&&(e=e.slice(9)),e=j+tn(e)),e),En=e=>_a.children.length,Cn=(e=2)=>Math.random()*e|0,$n=e=>{const t=new RegExp(`^${j}`);return kn(en(e.replace(t,"")))},Tn=e=>{qa?(0,R.t8)(et,e):Fa!=Ne&&yo(et,e)},An=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},In=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n};function Pn(e,t=!1){const a=e.map((e=>_n(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${En()<X?"":". Queue is full!"}`;B().alert({text:a,time:5})}))}function On(e,t){const a=t.dataset,n=e.dataset,o=e.common,s=e.format;if(n)Object.assign(a,n);else if(a.artist=o.artist||a.artist,a.title=o.title||a.title,a.album=o.album?o.album+(o.year?" ("+o.year+")":""):"",a.codec=s?s.codec||s.container:a.codec,s&&s.bitsPerSample?a.quality=(s.sampleRate/1e3|0)+"KHz / "+s.bitsPerSample+"bits":s.bitrate?a.quality=(s.bitrate/1e3|0)+"K "+(s.codecProfile||""):a.quality="",s&&s.duration?a.duration=An(s.duration):a.duration="",o.picture&&o.picture.length){const e=new Blob([o.picture[0].data],{type:o.picture[0].format});a.cover=URL.createObjectURL(e)}t==ja[Ta]&&Eo()}function Mn(e,t={}){return new Promise((a=>{En()>=X&&a(0);let n=kn(e.file);const o=en(n).split("/").pop(),s=o.split(".").pop(),l=document.createElement("li"),i=l.dataset;Object.assign(i,re),i.artist=t.artist||"",i.title=t.title||o.replace(/%23/g,"#")||n.slice(n.lastIndexOf("//")+2),i.duration=t.duration||"",i.codec=s!==o?s.toUpperCase():"",l.handle=e.handle,n=n.replace(/#/g,"%23"),i.file=n,_a.appendChild(l),i.retrieve=1,ho(),1!=En()||vn()?a(1):to(0).then((()=>a(1))),Ra>En()-3&&Jn()}))}function _n(e,t=!1){let a;return a=["m3u","m3u8"].includes(xn(e.file).extension)?Zn(e):Mn(e,Sn(xn(e.file).baseName)),a.then((e=>{t&&!vn()&&e>0&&lo(En()-e)})),a}function Rn(e){let t=e?an((+dt.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),So(t),Lo("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),Ho()}function Dn(e){const t=+St.value;(1==e&&t<+St.max||-1==e&&t>+St.min)&&(St.value=t+St.step*e,Ao(St)),Lo(`Analyzer height: ${St.value}%`)}function Fn(e){let t=an((+ua.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),Po(t),Lo("Volume: "+20*t),Ho()}function Bn(e=Ta){const t=ja[e],a=t.dataset;Yn(t,null),Object.assign(a,re),t.load(),e==Ta&&Eo()}function qn(e,t,a){const n=ot("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML=""),t&&ot("#toggle_console").classList.add("warning"),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function Nn(e,t){const a=hn(e)?e.elements[e.dataset.prop]:e.options;let n=(hn(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),hn(e)?a[n].checked=!0:e.selectedIndex=n,Ao(e)}function Hn(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function jn(){Ka&&Ka.key&&(delete ma[Ka.key],0===Object.keys(ma).filter((e=>!ma[e].disabled)).length&&(ma[Object.keys(ma)[0]].disabled=!1),co(),ro(),vo(Ue),vo(Ge),Ka=null,location.href="/#config")}function zn(e,t){if(bn(Na[e]))return;const a=`User Preset #${e+1}`,n=Na[e].name?"<br>"+Na[e].name:"";t?(Na[e]={},yo(Ke,Na),B().alert({text:`Deleted ${a}`})):B().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{zn(e,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}})}function Un(e=1){const t=ja[Ta];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),Lo(1),t.currentTime=a}"m"==Ga&&wo("m",e)}function Kn(){return clearTimeout(Aa),!!Ga&&(Ga=!1,!0)}async function Wn(){gn()&&await document.exitPictureInPicture(),Ca.toggleFullscreen(),document.activeElement.blur()}function Gn(e){if("F1"==e.code&&!e.altKey&&!e.ctrlKey)return location.href="#help",void e.preventDefault();if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?Dn(1):Fn(1);break;case"ArrowDown":t?Dn(-1):Fn(-1);break;case"ArrowLeft":t?Rn(-1):Ga?(Lo("Rewind",1),Un(-1)):wo("k",-1);break;case"ArrowRight":t?Rn(1):Ga?(Lo("Fast forward",1),Un()):wo("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(po(!0),Ao(Kt,!1));else if(t){const e=ln();e.randomMode=0,ko(a,e)}else Qn(a)}else switch(e.code){case"Delete":case"Backspace":_a.querySelectorAll(".selected").forEach((e=>{mo(e),e.remove()}));const e=nn(_a.querySelector(".current"));void 0!==e?Ra=e:Ra>En()-1?Ra=En()-1:Ra--,En()?Jn():(Bn(Oa),vn()||Bn());break;case"Space":Lo(vn()?"Pause":"Play",1),oo();break;case"ArrowLeft":case"KeyJ":Kn()||t||(Lo("Previous track",1),_o(!0));break;case"KeyG":Nn(Lt,t),Lo(un());break;case"ArrowRight":case"KeyK":Kn()||t||(Lo("Next track",1),_o());break;case"KeyA":Nn(Kt,t),Lo("Randomize: "+on(Kt)),Ao(Kt);break;case"KeyB":Nn(t?ft:ct);const a=ct.value[0];Lo("Background: "+on(ct)+(a>1&&a<7?` (${on(ft)})`:""));break;case"KeyC":Ut.click(),Lo("Radial "+wn(Ut));break;case"KeyD":Bo();break;case"KeyE":En()>0&&(Mo(),Lo("Shuffle"));break;case"KeyF":Wn();break;case"KeyH":wt.click();break;case"KeyI":oa.click(),Lo("Song info display "+wn(oa));break;case"KeyL":$t.click(),Lo("LED effect "+wn($t));break;case"KeyM":case"KeyV":Nn(Dt,t),Lo("Mode: "+on(Dt));break;case"KeyN":Nn(ea,t),Lo(on(ea).toUpperCase()+" sensitivity");break;case"KeyO":Ot.click(),Lo((yn(Ot)?"LOW":"HIGH")+" Resolution");break;case"KeyP":na.click(),Lo("Peaks "+wn(na));break;case"KeyR":Xt.click(),Lo("Queue repeat "+wn(Xt));break;case"KeyS":Lo("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+Zt.dataset.active+(Qt.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),Zt.dataset.active=1&t,Qt.dataset.active=t>>1,Ao([Zt,Qt]),t}(t)]);break;case"KeyT":Bt.click(),Lo((yn(Bt)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Mt.click(),Lo("Luminance bars "+wn(Mt));break;case"KeyX":Nn(Yt,t),Lo("Reflex: "+on(Yt));break;default:return}e.preventDefault()}function Yn(e,t){const a=e.src||"";fn(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src")}function Xn(e,t,a){return new Promise((n=>{Yn(t,URL.createObjectURL(e)),t.onloadeddata=()=>{a&&t.play(),n(!0)},_.Aj(e).then((e=>On(e,t))).catch((e=>{}))}))}async function Vn(e){return JSON.parse(q?await electron.api("storage-get",e):localStorage.getItem(e))}function Jn(){const e=Ra<En()-1?Ra+1:0,t=_a.children[e],a=ja[Oa];t&&(t.handle?t.handle.getFile().then((e=>Xn(e,a))).then((()=>a.load())):(Yn(a,t.dataset.file),a.load(),On(t,a))),Xa=!1}function Zn(e){let t=kn(e.file);return new Promise((async a=>{let n=[];const o=()=>{Promise.all(n).then((e=>{const t=e.reduce(((e,t)=>e+t),0);a(t)}))},s=async e=>{let a;Pt.dataset.path||To(t),t=xn(t).path;for(let o of e.split(/[\r\n]+/))if("#"!=o.charAt(0)&&""!=o.trim()){let e;o=kn(o),a||(a=xn(o).baseName),mn(o)||(qa&&(e=await I(o),e||qn(`Cannot resolve file handle for ${o}`,!0)),":"!=o[1]&&"/"!=o[0]&&(o=t+o)),n.push(Mn({file:Ln(o),handle:e},Sn(a))),a=""}else o.startsWith("#EXTINF")&&(a=o.slice(8));o()};if(t)if(["m3u","m3u8"].includes(xn(t).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(s).catch((e=>{qn(e,!0),a(0)})):fetch(t).then((e=>{if(200==e.status)return e.text();qn(`Fetch returned error code ${e.status} for URI ${t}`,!0)})).then(s).catch((e=>{qn(e,!0),a(0)}));else{const e=await Vn("pl_"+t);Array.isArray(e)?(e.forEach((e=>{e=kn(e),n.push(Mn({file:e},Sn(xn(e).baseName)))})),o()):(qn(`Unrecognized playlist file: ${t}`,!0),a(0))}else a(-1)}))}function Qn(e,t=!0,a,n){const o=+e==e,s=o?Na[e].options:cn(e),l=cn("default");bn(s)||(t&&qn("Loading "+(o?"User Preset #"+(e+1):"'"+dn(e)+"' preset")),void 0!==s.stereo&&(s.channelLayout=ga[+s.stereo][0]),st("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==s[t]?s[t]:a?l[t]:void 0;if(void 0!==o&&(e!=Kt||!n))if(hn(e)){const t=e.querySelector(`[value="${o}"]`);t&&(t.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+o:e==ua?Po(o):e==dt?So(o):(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),jo(e))})),Ca.setOptions({alphaBars:yn(lt),ansiBands:yn(rt),colorMode:sn(mt),fftSize:sn(yt),frequencyScale:sn(xt),ledBars:yn($t),linearAmplitude:yn(Tt),loRes:yn(Ot),lumiBars:yn(Mt),maxFPS:sn(_t),maxFreq:sn(Wt),minFreq:sn(Gt),mirror:sn(Rt),noteLabels:yn(qt),outlineBars:yn(Nt),radial:yn(Ut),roundBars:yn(Vt),showFPS:yn(wt),showPeaks:yn(na),showScaleX:yn(Zt),showScaleY:yn(Qt),smoothing:sn(sa),spinSpeed:sn(ia),splitGradient:yn(ra),weightingFilter:sn(fa)}),Ao([ct,ft,pt,ht,St,It,ea,Yt,Lt,Et,...n?[]:[Kt],ut,Dt]),"demo"==e&&po(!0),t&&B().alert({text:"Settings loaded!"}))}async function eo(e){Hn(zt);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,zt.options[zt.options.length]=t;const a=await Vn(tt);a&&Object.keys(a).forEach((t=>{const n=new Option(a[t],t);n.dataset.isLocal="1",t==e&&(n.selected=!0),zt.options[zt.options.length]=n})),fetch("playlists.cfg").then((e=>200==e.status&&(qn("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(zt.options[zt.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?qn(`${t} playlists loaded from playlists.cfg`):qn("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function to(e,t){return new Promise((a=>{const n=ja[Ta],o=()=>{qo(),Jn(),a(!0)};if(_a.children[e]){Ra=e;const a=_a.children[Ra];a.handle?a.handle.getFile().then((e=>Xn(e,n,t))).then((()=>o())):(Yn(n,a.dataset.file),n.onloadeddata=()=>{t&&n.play(),o()},On(a,n))}else a(!1)}))}function ao(){Ka={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(ma).some((e=>e===Ka.key))&&e<10;)Ka.key=`custom-gradient-${e}`,e++;fo(),ot("#btn-save-gradient").innerText="Add",ot("#btn-delete-gradient").style.display="none",location.href="/#gradient-editor"}function no(e){if(Xa||Ia||Ra>En()-1)return!0;if(Xa=!0,Ra<En()-1)Ra++;else{if(!yn(Xt))return Xa=!1,!1;Ra=0}return e|=vn(),Ta=Oa,Oa=0|!Ta,Eo(),e?ja[Ta].play().then((()=>Jn())).catch((e=>{20!=e.code&&(qn(e,!0),Jn(),no(!0))})):Jn(),qo(),!0}function oo(e){Ia||(vn()&&!e?(ja[Ta].pause(),gn()&&Qa.pause()):ja[Ta].play().catch((e=>{20!=e.code&&(qn(e,!0),no(!0))})))}function so(){let e=!0;return vn()?ja[Ta].currentTime>2?ja[Ta].currentTime=0:Ra>0?lo(Ra-1):e=!1:e=to(Ra-1),e}function lo(e){to(e,!0)}function io(e,t){const a=!Array.isArray(t[0]);for(const n of a?t.filter((e=>!e.disabled)):t){const t=e.dataset.prop,a=n.text||n[1],o=n.value||n[0],s=t+"-"+o,l=document.createElement("input"),i=document.createElement("label");l.name=t,l.id=s,l.type="radio",l.value=o,i.htmlFor=s,i.innerText=a,e.append(l,i)}}function ro(){const e=ot("#enabled_gradients");Hn(e),Object.keys(ma).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ma[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${ma[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ma[t].disabled?"":"checked"}>\n                   ${ma[t].name}\n                </label>`})),st(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(ma).reduce(((e,t)=>e+!ma[t].disabled),0)<2)return B().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;ma[e.dataset.grad].disabled=!e.checked,co(),vo(Ge)}))})),st(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!ma[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=ma[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});Ka=a}(e.target.getAttribute("data-grad")),fo(),ot("#btn-save-gradient").innerText="Save",ot("#btn-delete-gradient").style.display="block",location.href="/#gradient-editor"}))}))}function co(){for(const e of[Lt,Et]){let t=e.value;Hn(e);for(const t of Object.keys(ma))ma[t].disabled||(e.options[e.options.length]=new Option(ma[t].name,t));""!==t&&(e.value=t,Ao(e))}}function uo(e,t,a){const n=e.value,o=!Array.isArray(t[0]);a||Hn(e);for(const a of o?t.filter((e=>!e.disabled)):t){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),e[e.options.length]=t}""!==n&&(e.value=n,-1==e.selectedIndex&&(e.selectedIndex=0),Ao(e))}function po(e=Ia){if(!vn()&&!e)return;const t=e=>!va.find((t=>t.value==e)).disabled,a=(e,t=!0,a=(()=>!0))=>{let o=9;do{if(hn(e)){const t=e.elements[e.dataset.prop];t[Cn(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=Cn();else if(e.step){const{min:t,max:a,step:n}=e,o=Cn((a-t)/n+1)*n+ +t;e.value=(10*o|0)/10,jo(e)}else e.selectedIndex=Cn(e.options.length)}while(!a(sn(e))&&o--);t&&n.push(e)};let n=[];if(t(Me)){const e=Na.map(((e,t)=>bn(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&Qn(e[Cn(t)],!1,!1,!0)}if(t(Ie)&&a(Dt),t(ve)&&a(lt),t(ye)&&a(ct,!1),t(we)&&a(ft),t(xe)&&a(ht,!0,(e=>e!=ce)),t(Se)&&a(mt),t(Oe)&&a(na),t(Ce)&&a($t),t(Te)&&a(Mt,!0,(e=>!e||ct.value[0]<=1||!yn($t))),t($e)&&a(At,!1),t(Le)&&a(kt,!1),t(ke)&&a(ut,!1),t(Pe)&&a(Nt),t(De)&&a(Yt,!1,(e=>e!=ge||!yn($t))),t(_e)&&a(Ut),t(Fe)&&a(Vt),t(Re)&&a(ia),t(Be)&&a(ra),t(Ae)&&a(Rt),t(Ee))for(const e of[Lt,...yn(It)?[]:[Et]])a(e);n.push(ct,Yt,Dt),Ao(n)}function fo(){if(null==Ka)throw new Error("Current gradient must be set before editing gradient");const e=ot("#grad-color-table");Hn(e),ot("#new-gradient-name").value=Ka.name,ot("#new-gradient-horizontal").checked="h"===Ka.dir;const t=ot("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),Ka.colorStops.forEach(((e,t)=>{!function(e,t){const a=ot("#grad-color-table"),n=ot("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),l=n.querySelector(".grad-color-stop"),i=n.querySelector(".grad-add-stop"),r=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,l.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,Ka.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,Ka.colorStops[e].color=o.value})),l.addEventListener("input",(t=>{Ka.colorStops[e].pos=parseFloat(t.target.value)})),i.addEventListener("click",(()=>{Ka.colorStops.splice(e+1,0,{pos:(()=>{if(e===Ka.colorStops.length-1){const e=Ka.colorStops[Ka.colorStops.length-1].pos;return Ka.colorStops[Ka.colorStops.length-1].pos=(Ka.colorStops[Ka.colorStops.length-2].pos+e)/2,e}return(Ka.colorStops[e].pos+Ka.colorStops[e+1].pos)/2})(),color:"#111111"}),fo()})),2===Ka.colorStops.length?r.setAttribute("disabled","true"):r.addEventListener("click",(()=>{Ka.colorStops.splice(e,1),fo()})),n.removeAttribute("id"),a.appendChild(n)}(t,Ka.colorStops[t])})),ot("#new-gradient-bkgd").value=Ka.bgColor}function ho(){if(Va>=Y)return;const e=Array.from(_a.children).find((e=>e.dataset.retrieve));if(e){if(Va++,delete e.dataset.retrieve,e.handle)return;const t=e.dataset.file;_.eF(t,{skipPostHeaders:!0}).then((a=>{a&&(On(a,e),Fo(e),a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=xn(e).path;if(Fa==Ne||mn(e))t("");else if(void 0!==Wa[a])t(Ln(a+Wa[a]));else{const e=Fa==qe?z+tn(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let n="";if(e)if(Fa==qe)n=e;else{const t=O(e);t.cover&&(n=t.cover)}Wa[a]=n,t(Ln(a+n))}))}}))}(t).then((t=>{e.dataset.cover=t,Fo(e)})))})).catch((e=>{})).finally((()=>{Va--,ho()}))}}function mo(e){const t=e.dataset.cover;fn(t)&&URL.revokeObjectURL(t)}function bo(){null!==Ka&&(ma[Ka.key]=Ka,Ca.registerGradient(Ka.key,Ka),co(),ro(),vo(Ue),Ka=null,location.href="/#config")}function go(e,t){if(0==En())return void B().alert({text:"Queue is empty!"});if(!e)return void B().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?go(T(e,!0)):B().alert({text:"Canceled"})},cancelCallback:()=>{B().alert({text:"Canceled"})}});const a=[];_a.childNodes.forEach((e=>{const{file:t,artist:n,title:o,duration:s}=e.dataset;a.push({file:$n(t),artist:n,title:o,duration:s})})),fetch(U+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const n=e?`${t?"Updated":"Saved as"} ${xn(e).fileName}`:a;B().alert({text:n}),To(e),$(null,v.scrollTop)}))}function vo(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Ye||yo(Ye,t(ba)),e&&e!=We||yo(We,t(wa)),e&&e!=Ge||yo(Ge,Object.keys(ma).filter((e=>ma[e].disabled))),!e||e==Ue){const e={};Object.keys(ma).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=ma[t])),yo(Ue,e)}if(e&&e!=Xe||yo(Xe,t(va)),!e||e==at){let e=[];for(const t of[0,1,2])e.push({min:ot(`.min-db[data-preset="${t}"]`).value,max:ot(`.max-db[data-preset="${t}"]`).value,boost:ot(`.linear-boost[data-preset="${t}"]`).value});yo(at,e)}if(!e||e==Ve){const e={info:Ct.value,track:ca.value,end:vt.value,covers:aa.checked,count:ta.checked};yo(Ve,e)}if(!e||e==Ze){const e={fftSize:yt.value,fsHeight:St.value,maxFPS:_t.value,pipRatio:jt.value,saveDir:Jt.checked,smoothing:sa.value};yo(Ze,e)}}function yo(e,t){const a=JSON.stringify(t);q?electron.api("storage-set",e,a):localStorage.setItem(e,a)}function ko(e,t,a,n){const o=`User Preset #${e+1}`,s=Na[e].name||"",l=Ca.isFullscreen;if(!bn(Na[e])&&!n&&Ya!==e)return void(l?(Lo(`Overwrite ${o} - Press again to confirm!`,5),Ya=e,setTimeout((()=>{Ya===e&&(Ya=!1)}),5e3)):B().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{ko(e,t,a,!0)},cancelCallback:()=>{B().alert({text:"Canceled!"})}}));if(Ya=!1,!a||!`${a}`.trim()){if(!l)return void B().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{ko(e,t,a.trim()||nt,!0)},cancelCallback:()=>{B().alert({text:"Save canceled!"})}});a=""}a==nt&&(a=""),Na[e]={name:a,options:t},yo(Ke,Na);const i=`Saved to ${o}`;l?Lo(i,5):B().alert({text:i})}function wo(e,t=1){Aa=setTimeout((()=>{Ga=e,Un(t)}),200)}function xo(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function So(e){dt.dataset.value=e,Ma&&(Ma.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),dt.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function Lo(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?($a.info=e,$a.startTime=n,$a.endTime=Math.max(o,$a.endTime||0),$a.fade=t==1/0?0:t/3*a):($a.msg=e,2==$a.info&&($a.info=1),$a.msgTimer=o)}else $a={endTime:0,msgTimer:0}}function Eo(){Za.src=ja[Ta].dataset.cover,ct.value==Z&&xo(Za.src)}function Co(e){yt.value=e.fftSize,St.value=e.fsHeight,_t.value=e.maxFPS,jt.value=e.pipRatio,Jt.checked=e.saveDir,sa.value=e.smoothing}function $o(e){Ct.value=e.info,ca.value=e.track,vt.value=e.end,aa.checked=e.covers,ta.checked=e.count}function To(e=""){q&&(e=$n(e),Pt.dataset.path=tn(e),Pt.innerText=xn(e).fileName,Pt.title=en(e,!0))}function Ao(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>Et.style.display=sn(ht)==de||yn(It)?"none":"";for(const o of e){switch(o){case lt:Ca.alphaBars=yn(lt);break;case rt:Ca.ansiBands=yn(rt);break;case ct:const e=ct.value[0],t=e!=V&&e!=J;let s=ct.value.slice(1);Ca.overlay=t,Ca.showBgColor=e==V,e==ee?(xo(),da.style.display="",s||(s=Ua[Cn(Ua.length)]),decodeURIComponent(da.src).endsWith(s)||(da.src=G+"/"+encodeURIComponent(s))):(da.style.display="none",t?(e!=Q||s||(s=za[Cn(za.length)]),s&&(s=G+"/"+encodeURIComponent(s)),xo(s||Za.src)):xo());break;case ft:const l=ft.value,i=l==se||l==le||l==ie;bt.classList.toggle("repeat",l==ne),bt.classList.toggle("cover",l==te||i),bt.style.backgroundSize="",pa.style.display=i?"":"none",pa.classList.toggle("rotating",l==ie),pa.classList.toggle("paused",l==se);break;case pt:gt.style.background=`rgba(0,0,0,${1-pt.value})`;break;case ut:Ca.barSpace=Ca.isLumiBars?1.5:sn(ut);break;case ht:Ca.channelLayout=sn(ht),a();break;case mt:Ca.colorMode=sn(mt);break;case kt:Ca.fillAlpha=Dt.value==he?1:kt.value;break;case yt:Ca.fftSize=yt.value,qn("FFT size is "+Ca.fftSize+" samples");break;case xt:Ca.frequencyScale=sn(xt);break;case St:it.style.height=`${St.value}%`;break;case Gt:case Wt:for(;+Wt.value<=+Gt.value;)Wt.selectedIndex++;Ca.setFreqRange(Gt.value,Wt.value);break;case Lt:case Et:""===o.value&&(o.selectedIndex=0),yn(It)?Ca.gradient=Lt.value=Et.value=o.value:Ca[o==Lt?"gradientLeft":"gradientRight"]=o.value;break;case $t:Ca.ledBars=yn($t);break;case Tt:Ca.linearAmplitude=yn(Tt);break;case At:Ca.lineWidth=Dt.value==he?0:At.value;break;case It:a();break;case Ot:Ca.loRes=yn(Ot);break;case Mt:Ca.lumiBars=yn(Mt),Ao(ut,!1);break;case _t:Ca.maxFPS=_t.value;break;case Dt:const r=Dt.value;[he,me].includes(r)?Ca.mode=10:Ca.mode=r,r==he?(Ca.lineWidth=0,Ca.fillAlpha=1):(Ca.lineWidth=At.value,Ca.fillAlpha=kt.value),Ao(ut,!1);break;case Rt:Ca.mirror=sn(Rt);break;case qt:Ca.noteLabels=yn(qt);break;case Nt:Ca.outlineBars=yn(Nt);break;case jt:gn()&&(Ca.width=Ca.height*jt.value);break;case Ut:Ca.radial=yn(Ut),Ao(ut,!1);break;case Kt:const c=Kt.value;Da&&(Da=clearInterval(Da)),c>1&&(Da=setInterval(po,2500*c));break;case Yt:switch(sn(Yt)){case be:Ca.reflexRatio=.4,Ca.reflexAlpha=.2;break;case ge:Ca.reflexRatio=.5,Ca.reflexAlpha=1;break;default:Ca.reflexRatio=0}break;case Vt:Ca.roundBars=yn(Vt);break;case Jt:Jt.checked?Tn(k):((0,R.IV)(et),n=et,q?electron.api("storage-remove",n):localStorage.removeItem(n));case Zt:Ca.showScaleX=yn(Zt);break;case Qt:Ca.showScaleY=yn(Qt);break;case ea:const d=sn(ea);Ca.setSensitivity(ot(`.min-db[data-preset="${d}"]`).value,ot(`.max-db[data-preset="${d}"]`).value),Ca.linearBoost=ot(`.linear-boost[data-preset="${d}"]`).value;break;case wt:Ca.showFPS=yn(wt);break;case na:Ca.showPeaks=yn(na);break;case sa:Ca.smoothing=sa.value,qn("smoothingTimeConstant is "+Ca.smoothing);break;case ia:Ca.spinSpeed=ia.value;break;case ra:Ca.splitGradient=yn(ra);break;case fa:Ca.weightingFilter=sn(fa)}t&&(xa.includes(o)?vo(Ze):Ho())}var n}async function Io(){Ia=la.checked,Ia?q&&!await electron.api("ask-for-media-access")||!navigator.mediaDevices?(qn("Cannot access user microphone",!0),la.checked=Ia=!1):navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Pa=Ca.audioCtx.createMediaStreamSource(e),vn()&&ja[Ta].pause(),Ha=Ft.checked,No(!0),Ca.connectInput(Pa),qn("Audio source set to microphone")})).catch((e=>{qn(`Could not change audio source - ${e}`,!0),la.checked=Ia=!1})):(Pa&&(Ca.disconnectInput(Pa),Pa.mediaStream.getTracks()[0].stop(),Pa=null,No(Ha)),qn("Audio source set to built-in player"))}function Po(e){ua.dataset.value=e,Ca.volume=e**2.5,ua.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function Oo(){const e=ot("#toggle_settings");e.addEventListener("click",(()=>{ot("#settings").classList.toggle("active",e.classList.toggle("active"))})),ot(".settings-close").addEventListener("click",(()=>e.click()));const t=ot("#toggle_console");let a;t.addEventListener("click",(()=>{ot("#console").classList.toggle("active",t.classList.toggle("active")),t.classList.remove("warning"),qn()})),ot("#console-close").addEventListener("click",(()=>t.click())),ot("#console-clear").addEventListener("click",(()=>qn("Console cleared.",!1,!0))),st(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,Ao(e)}))})),st("[data-prop]").forEach((e=>{hn(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>Ao(e)))})):e.addEventListener("change",(()=>{Ao(e),jo(e)}))})),la.addEventListener("change",Io),Ft.addEventListener("change",(()=>No())),[ua,dt].forEach((e=>{e.addEventListener("wheel",(t=>{if(t.preventDefault(),a)return;a=setTimeout((()=>a=!1),50);const n=Math.sign(t.deltaY||0);e==ua?Fn(n):Rn(n)}))})),dt.addEventListener("dblclick",(()=>{Rn(0)})),ot("#btn_play").addEventListener("click",(()=>oo())),ot("#btn_stop").addEventListener("click",Ro),ot("#btn_shuf").addEventListener("click",Mo),ot("#btn_prev").addEventListener("mousedown",(()=>wo("m",-1))),ot("#btn_prev").addEventListener("click",(e=>{Kn()||_o(!0)})),ot("#btn_next").addEventListener("mousedown",(()=>wo("m"))),ot("#btn_next").addEventListener("click",(()=>{Kn()||_o()})),ot("#load_preset").addEventListener("click",(()=>{const e=[];ha.forEach((t=>{bn(t.options)||e.push({text:t.name+("default"==t.key?" (warning: resets Volume!)":""),handler:()=>Qn(t.key)})})),e.push({text:"<strong>USER PRESETS →</strong>",handler:()=>{const e=[];pn().forEach(((t,a)=>{e.push({text:t,handler:()=>Qn(a)})})),B().select({text:"LOAD PRESET:",choices:e})}}),B().select({text:"LOAD PRESET:",choices:e})})),ot("#btn_save").addEventListener("click",(()=>{const e=[];pn().forEach(((t,a)=>{const n=Na[a].options;e.push({type:1,text:t,handler:()=>ko(a,ln())},{type:2,text:bn(n)?"":'<button title="Edit name">&#xf11f;</button>',handler:()=>ko(a,n,"",!0)},{type:2,text:bn(n)?"":'<button title="Delete preset">&#xf120;</button>',handler:()=>zn(a)})})),B().select({text:"<strong>Click slot to SAVE - Use buttons to Edit or Delete</strong>",choices:e})})),ot("#btn_fullscreen").addEventListener("click",Wn),ot("#save_playlist").addEventListener("click",(()=>{if(q){const e=Pt.dataset.path;e?B().confirm({text:`<strong>${Pt.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>go(e,!0),cancelCallback:()=>B().alert({text:"Canceled"})}):go()}else e=zt.selectedIndex,""==zt[e].value?Do():zt[e].dataset.isLocal?B().confirm({text:`Overwrite "${zt[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{Do(zt[e].value)},cancelCallback:()=>{B().alert({text:"Canceled"})}}):B().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),ot("#create_playlist").addEventListener("click",(()=>q?go():Do())),ot("#btn_clear").addEventListener("click",(()=>{!function(){for(;_a.hasChildNodes();)mo(_a.removeChild(_a.firstChild));vn()?Ra=-1:(Ra=0,Bn(Ta)),Bn(Oa),qo()}(),To()})),(q?ot(".playlist-bar"):Pt).style.display="none",q||(ot("#load_playlist").addEventListener("click",(()=>{Zn({file:zt.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;B().alert({text:t,time:5})}))})),ot("#delete_playlist").addEventListener("click",(()=>{return e=zt.selectedIndex,void(zt[e].dataset.isLocal?B().confirm({text:`Do you really want to DELETE the "${zt[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=zt[e].value,a=await Vn(tt);a&&(delete a[t],yo(tt,a)),localStorage.removeItem(`pl_${t}`),B().alert({text:"Playlist deleted"}),eo()},cancelCallback:()=>{B().alert({text:"Canceled"})}}):zt[e].value&&B().alert({text:"Cannot delete a server playlist!"}));var e}))),Ht.addEventListener("click",(()=>Bo()));const n=ot("#btn_toggle_filesystem");(Ba||qa)&&H?(n.innerText="Use "+(qa?"server":"local")+" music",n.addEventListener("click",(()=>{yo(Je,!qa),location.href=K}))):n.style.display="none";const o=ot("#btn_add_selected"),s=ot("#btn_add_folder");q||Ba||qa?(o.addEventListener("mousedown",(()=>Pn(A(".selected")))),s.addEventListener("click",(()=>Pn(A())))):(o.style.display="none",s.style.display="none");const l=ot("#local_file");let i,r;q||H?l.parentElement.style.display="none":l.addEventListener("change",(e=>function(e){const t=e.files[0];t&&(Bn(),Xn(t,ja[Ta],!0))}(e.target))),ot("#btn_load_url").addEventListener("click",(()=>{B().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&_n({file:e},!0)}})}));const c=ot("#btn_pip");document.pictureInPictureEnabled?c.addEventListener("click",(async()=>{if(Qa!==document.pictureInPictureElement){const e=Ca.canvas.captureStream();i=e.getTracks()[0],Qa.muted=!0,Qa.srcObject=e,await Qa.play(),Qa.requestPictureInPicture()}else document.exitPictureInPicture()})):c.classList.add("disabled");const d=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>Ca.setCanvasSize(r.width,r.height)));Qa.addEventListener("enterpictureinpicture",(e=>{r=e.pictureInPictureWindow,bt.classList.add("pip"),c.classList.add("active"),Ca.setCanvasSize(r.height*jt.value,r.height),r.addEventListener("resize",d)})),Qa.addEventListener("leavepictureinpicture",(()=>{r.removeEventListener("resize",d),Qa.pause(),i.stop(),Qa.srcObject=i=null,c.classList.remove("active"),bt.classList.remove("pip"),Ca.setCanvasSize()}));const u=navigator.mediaSession;u&&(u.setActionHandler("play",(()=>oo())),u.setActionHandler("pause",(()=>oo())),u.setActionHandler("previoustrack",(()=>so())),u.setActionHandler("nexttrack",(()=>no()))),ot("#add-gradient").addEventListener("click",ao),ot("#btn-save-gradient").addEventListener("click",bo),ot("#btn-delete-gradient").addEventListener("click",jn),ot("#new-gradient-bkgd").addEventListener("input",(e=>{Ka.bgColor=e.target.value})),ot("#new-gradient-name").addEventListener("input",(e=>{Ka.name=e.target.value})),ot("#new-gradient-horizontal").addEventListener("input",(e=>{Ka.dir=e.target.checked?"h":void 0}))}function Mo(){for(let e=En()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=_a.replaceChild(_a.children[t],_a.children[e]);_a.insertBefore(a,_a.children[t])}lo(0)}function _o(e=!1){(e?so():no())||Lo(`Already at ${e?"first":"last"} track`)}function Ro(){ja[Ta].pause(),Lo(),to(0)}async function Do(e,t=!0){if(0!=En())if(e){if(e){let a=e;if(!t){a=a.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=a.toLowerCase().replace(/[^a-z0-9]/g,"_");const t=await Vn(tt)||{};for(;t.hasOwnProperty(a);)a+="_1";t[a]=e,yo(tt,t),eo(a)}let n=[];_a.childNodes.forEach((e=>n.push(e.dataset.file))),yo("pl_"+a,n),B().alert({text:"Playlist saved!"})}}else B().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&Do(e,!1)},cancelCallback:()=>{B().alert({text:"Canceled"})}});else B().alert({text:"Queue is empty!"})}function Fo(e){for(const t of ja)t.dataset.file==e.dataset.file&&On(e,t)}function Bo(){$a.endTime<performance.now()&&($a.info=0),2==$a.info?Lo():Lo(1+(0|$a.info),+Ct.value||1/0)}function qo(){const e=_a.querySelector(".current"),t=_a.children[Ra];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function No(e){void 0!==e?Ft.checked=e:e=Ft.checked,e?Ca.disconnectOutput():Ca.connectOutput()}function Ho(){yo(Qe,{...ln(),volume:ua.dataset.value,balance:dt.dataset.value})}function jo(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){let e,t,a,o,s,d,u,A,I,O,_,F,N;const j=e=>{no(!0)||(to(0),Lo("Queue ended",10),gn()&&Qa.pause())},z=e=>{e.target.attributes.src&&qn("Error loading "+e.target.src,!0)},U=e=>{ja[Ta].attributes.src?(gn()&&Qa.play(),ja[Ta].currentTime<.1&&"1"==Kt.value&&po(!0),yn(oa)&&Lo(1,+ca.value||1/0)):lo(Ra)};window.addEventListener("error",(e=>qn(`Unexpected ${e.error}`,!0)));let Y=!1;qn(`audioMotion v${W} initializing...`),qn(`User agent: ${navigator.userAgent}`),ot("#version").innerText=W,q&&qn(`Reading user preferences from ${await electron.api("storage-info")}`);const X=await async function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=t.find((e=>e.value==a));o&&(o.disabled=n)}))},t=await Vn(Qe),a=null!==t;((e,t)=>{const a=rn("last");-1!=a&&(ha[a].options=t)})(0,{...cn("default"),...t}),Na=await Vn(Ke)||[],Array.isArray(Na)||(Na=[{name:"Custom",options:Na}]);for(let e=0;e<9;e++)void 0===Na[e]?Na[e]={}:bn(Na[e])||Na[e].options||(Na[e]={options:Na[e]});e(await Vn(Ye),ba),e(await Vn(We),wa);const n=await Vn(Ue);n&&Object.keys(n).forEach((e=>{ma[e]=n[e]}));const o=await Vn(Ge);Array.isArray(o)&&o.forEach((e=>{ma[e].disabled=!0})),e(await Vn(Xe),va);const s=st(".min-db");s.forEach((e=>In(e,-120,-60)));const l=st(".max-db");l.forEach((e=>In(e,-50,0)));const i=st(".linear-boost");i.forEach((e=>In(e,1,5,.2))),(await Vn(at)||ya).forEach(((e,t)=>{s[t].value=e.min,l[t].value=e.max,i[t].value=e.boost||ya[t].boost})),$o({...ka,...await Vn(Ve)||{}});for(let e=10;e<16;e++)yt[yt.options.length]=new Option(2**e);return In(sa,0,.9,.1),uo(jt,Ea),In(St,25,100,5),uo(_t,La),Co({...Sa,...await Vn(Ze)||{}}),a}();_a=ot("#playlist"),_a.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(lo(nn(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),Ra=0,D.ZP.create(_a,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{Ra=nn(_a.querySelector(".current")),0!=e.newIndex||vn()||to(0),Jn()}}),qn(`Instantiating audioMotion-analyzer v${n.Z.version}`),Ca=new n.Z(it,{fsElement:bt,onCanvasDraw:(n,l)=>{const i=ja[Ta],r=i.dataset,c=i.duration-i.currentTime,p=+vt.value,f=ct.value[0],h=ft.value,m=yn(Bt),b=Ca.pixelRatio,{timestamp:g}=l;if(c<.1&&no(!0),p>0&&c<=p&&yn(oa)&&g>$a.endTime&&vn()&&Lo(1,c,1),!(h!=oe&&"4"!=h&&"5"!=h||f!=Z&&f!=Q)){let e;if(h==oe)e=(70*Ca.getEnergy()|0)-25;else{const t=i.currentTime/i.duration;e=100*("4"==h?t:1-t)}bt.style.backgroundSize=`auto ${100+e}%`}Ht.width|=0;const{endTime:v,startTime:y,msgTimer:k,info:w,msg:x,fade:S}=$a;if(g>v&&g>k)return;const L=(e,t,a,n)=>{m?(Ja.strokeText(e,t,a,n),Ja.fillText(e,t,a,n)):(Ja.shadowOffsetX=Ja.shadowOffsetY=3*b,Ja.fillText(e,t,a,n),Ja.shadowOffsetX=Ja.shadowOffsetY=0)};if(Ja.lineWidth=4*b,Ja.lineJoin="round",Ja.font=F,Ja.textAlign="center",Ja.fillStyle="#fff",Ja.strokeStyle=Ja.shadowColor="#000",k>g&&(g>v||2!=w)){const e=(k-g)/1e3;Ja.globalAlpha=e>1?1:e,L($a.msg,a,s)}if(v>g){if(S<0){const e=(v-g)/1e3;Ja.globalAlpha=e>-S?1:e/-S}else{const e=Math.max(0,(g-y)/1e3);Ja.globalAlpha=e>S?1:e/S}if(2==$a.info&&(L(un(),a,s,O),Ja.textAlign="left",L(on(Dt),e,s,O),L(`Randomize: ${on(Kt)}`,e,d,O),Ja.textAlign="right",L(on(ea).toUpperCase()+" sensitivity",o,s,O),L(`Repeat is ${wn(Xt)}`,o,d,O)),Ia)Ja.textAlign="left",Ja.font=N,L("MIC source",e,A,_);else{Ja.textAlign="right",L(r.codec,o,u),L(r.quality,o,u+e);const a=En();a&&ta.checked&&L(`Track ${(""+(Ra+1)).padStart((""+a).length,"0")} of ${a}`,o,u-e),Ja.textAlign="left",L(r.artist.toUpperCase(),e,u,_),Ja.font=`italic ${F}`,L(r.album,e,I,_),Ja.font=N,L(i.src?r.title:"No song loaded",e,A,_),(i.duration||r.duration)&&(r.duration||(r.duration=An(i.duration),_a.children[Ra]&&(_a.children[Ra].dataset.duration=r.duration)),Ja.textAlign="right",L(An(i.currentTime)+" / "+r.duration,o,I)),Za.width&&aa.checked&&Ja.drawImage(Za,e,u-1.3*t,t,t)}}},onCanvasResize:(n,l)=>{let i;const r=l.pixelRatio,c=Ht.width=bt.clientWidth*r,p=Ht.height=bt.clientHeight*r;switch(n){case"create":qn(`Display resolution: ${l.fsWidth} x ${l.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),i="Canvas created";break;case"lores":i=`Lo-res ${l.loRes?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":i=(l.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"resize":i="Window resized";break;case"user":i=(gn()?"Resized for":"Closed")+" PIP"}qn(`${i||n}. Canvas size is ${l.canvas.width} x ${l.canvas.height} px`),e=Math.min(c,p)/17,t=3*e,a=c/2,o=c-e,s=1.4*e,d=1.8*s,O=c/3-e,u=p-4*e,A=p-2.8*e,I=p-1.6*e,_=c-7*e,F=`bold ${.7*e}px sans-serif`,N=`bold ${e}px sans-serif`}});const te=Ca.audioCtx;te.createStereoPanner&&(Ma=te.createStereoPanner(),Ca.connectInput(Ma)),Ta=0,Oa=1;for(const e of[0,1])ja[e]=ot(`#player${e}`),Bn(e),ja[e].addEventListener("play",U),ja[e].addEventListener("ended",j),ja[e].addEventListener("error",z),Ma?te.createMediaElementSource(ja[e]).connect(Ma):Ca.connectInput(ja[e]);!function(){const e=(e,t,a,n,o)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),st(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return B().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,uo(n,a),vo(o))}))}))};e(ot("#enabled_modes"),"enabledMode",ba,Dt,Ye),e(ot("#enabled_bgfit"),"enabledBgFit",wa,ft,We);const t=ot("#enabled_gradients");Object.keys(ma).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${ma[e].disabled?"":"checked"}> ${ma[e].name}</label>`})),ro();const a=ot("#random_properties");va.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),st(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{va.find((t=>t.value==e.value)).disabled=!e.checked,vo(Xe)}))})),st("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;ot(`.min-db[data-preset="${t}"]`).value=ya[t].min,ot(`.max-db[data-preset="${t}"]`).value=ya[t].max,ot(`.linear-boost[data-preset="${t}"]`).value=ya[t].boost,st(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==sn(ea)&&Ao(ea,!1),vo(at)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==sn(ea)&&Ao(ea,!1),vo(at)),e.classList.toggle("field-error",!t)}))}));for(const e of[Ct,ca,vt,aa,ta])e.addEventListener("change",(()=>vo(Ve)));ot("#reset_osd").addEventListener("click",(()=>{$o(ka),vo(Ve)})),xa.forEach((e=>{e.addEventListener("change",(()=>Ao(e)))})),ot("#reset_general").addEventListener("click",(()=>{Co(Sa),Ao(xa)}))}(),uo(Dt,ba);for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])Gt[Gt.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])Wt[Wt.options.length]=new Option(e/1e3+"kHz",e);io(ht,ga),io(ea,[["0","Low"],["1","Normal"],["2","High"]]),io(ut,[["1.5","Min"],["0.1","10"],["0.25","25"],["0.5","50"],["0.75","75"]]),uo(Kt,[["0","OFF"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),io(Yt,[["0","Off"],["1","On"],["2","Full"]]),uo(ct,[[Z,"Album cover"],[J,"Black"],[V,"Gradient default"]]),uo(ft,wa),io(Rt,[["-1","Left"],["0","Off"],["1","Right"]]),io(xt,[[He,"Bark"],["linear","Lin"],[je,"Log"],["mel","Mel"]]),io(fa,[["","OFF"],["A","A"],["B","B"],["C","C"],[ze,"D"],["468","468"]]),io(mt,[[ue,"Gradient"],[pe,"Index"],[fe,"Level"]]);const ae=fetch(G).then((e=>e.text())).then((e=>{const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp4|webm|mov)$/i;for(const{file:n}of P(e))t.test(n)?za.push(n):a.test(n)&&Ua.push(n);const n=za.length,o=Ua.length,s=za.map((e=>[Q+e,"🖼️ "+xn(e).baseName])).concat(Ua.map((e=>[ee+e,"🎬 "+xn(e).baseName]))).slice(0,20);o&&s.splice(0,0,[ee,"Random video"]),n&&s.splice(0,0,[Q,"Random image"]),qn("Found "+(n+o==0?"no media":n+" image files and "+o+" video")+" files in the backgrounds folder"),uo(ct,s,!0)})).catch((e=>{}));In(pt,.1,1,.1),In(At,1,3,.5),In(kt,0,.5,.1),In(ia,0,3,1),Lo(),Object.keys(ma).forEach((e=>{ma[e].colorStops&&Ca.registerGradient(e,{bgColor:ma[e].bgColor,colorStops:ma[e].colorStops})})),co(),Io(),eo();const ne=new URL(document.location).searchParams.get("mode");let se="local"==ne||"server"!=ne&&await Vn(Je);null===se&&(se=!0);const le=function(e,t={}){let a;return g=document.createElement("ul"),g.className="breadcrumb",e.append(g),v=document.createElement("ul"),v.className="filelist",e.append(v),a=setTimeout((()=>{g.innerHTML="Waiting for server..."}),5e3),g.innerHTML="Initializing... please wait...",g.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=k.pop(),e--;const a=k[k.length-1];a&&a.handle&&(f=a.handle,t=null),$(t,t&&t.scrollTop)}(e.target.dataset.depth)})),v.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)$(t.handle||t.dataset.path);else if("request"==t.dataset.type)"granted"==await b[0].handle.requestPermission()&&(x=!1,M(b));else if("mount"==t.dataset.type)if(E)try{f=await window.showDirectoryPicker({startIn:"music"}),k=[],$(f)}catch(e){}else k=[],$(t.dataset.path)})),v.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&h&&["file","list"].includes(t.dataset.type)&&h({file:T(t.dataset.path),handle:t.handle},e)})),"function"==typeof t.onDblClick&&(h=t.onDblClick),"function"==typeof t.onEnterDir&&(m=t.onEnterDir),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async n=>{if(clearTimeout(a),n.startsWith("audioMotion")?(S=!0,y=1):y=p,1==y&&l){const e=await fetch("/getMounts");w=await e.json(),M(await async function(){const e=await fetch("/getHomeDir"),t=await e.text();let a=[];for(const e of t.split(i?"\\":"/"))a.push({dir:e,scrollTop:0});return a}())}else w=[t.rootPath||"/music"],L=await $(w[0]),(t.forceFileSystemAPI&&r||!L)&&(k=[],r?(w=[c],E=!0,b=t.lastDir,Array.isArray(b)&&b[0]&&(x=!0)):w=[],C());e({serverMode:y,useFileSystemAPI:E,hasServerMedia:L,filelist:v,serverSignature:y==p?"Standard web server":n})})).catch((t=>{clearTimeout(a),y=-1,r?(w=[c],E=!0):w=[],C(),e({serverMode:y,useFileSystemAPI:E,filelist:v})}))}))}(ot("#file_explorer"),{onDblClick:(e,t)=>{Pn([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{Jt.checked&&Y&&Tn(e)},forceFileSystemAPI:se,lastDir:await(0,R.U2)(et)}).then((e=>{Fa=e.serverMode,Ba=e.hasServerMedia,qa=e.useFileSystemAPI;const{filelist:t,serverSignature:a}=e;Fa!=Ne&&qn(`${a} detected at ${K}`),Ba||qn(Fa==Ne?"No server found":"Cannot access music directory on server",!0),qa&&qn("Accessing files from local device via File System Access API."),H||qn("No browser support for File System Access API. Cannot access files from local device.",se),q||yo(Je,se&&H),(q||qa||Ba)&&D.ZP.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{"playlist"==e.to.id&&(e.items.length?e.items:[e.item]).forEach((e=>{_n({file:T(e.dataset.path),handle:e.handle}),e.remove()}))}}),Oo()}));window.addEventListener("keydown",Gn),window.addEventListener("keyup",Gn),B().setOptions({positions:{alert:"bottom"}}),Promise.all([ae,le]).then((async()=>{qn(`Loading ${X?"last session":"default"} settings`),Qn("last",!1,!0),qa||M(await Vn(et)),qn(`AudioContext sample rate is ${te.sampleRate}Hz; Total latency is ${1e3*((te.outputLatency||0)+te.baseLatency)|0}ms`),qn("Initialization complete!"),Y=!0}))}()},7379:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,l=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,i=this.offsetLeft-t.offsetLeft<t.scrollLeft,r=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!l;(s||l)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(i||r)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||l||i||r)&&!e&&this.scrollIntoView(c)})},9283:()=>{},3838:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var l=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],i=!0,r=0;r<a.length;r++)(!1&s||l>=s)&&Object.keys(n.O).every((e=>n.O[e](a[r])))?a.splice(r--,1):(i=!1,s<l&&(l=s));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[l,i,r]=a,c=0;if(l.some((t=>0!==e[t]))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(r)var d=r(n)}for(t&&t(a);c<l.length;c++)s=l[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[216],(()=>n(2301)));o=n.O(o)})();
//# sourceMappingURL=audioMotion.js.map